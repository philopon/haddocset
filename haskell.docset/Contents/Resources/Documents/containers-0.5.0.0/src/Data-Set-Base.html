<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Data/Set/Base.hs</title>
<link type="text/css" rel="stylesheet" href="hscolour.css"></link>
</head>
<body>
<pre><a name="line-1"></a><span class="hs-comment">{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__</span>
<a name="line-3"></a><span class="hs-comment">{-# LANGUAGE DeriveDataTypeable, StandaloneDeriving #-}</span>
<a name="line-4"></a><span class="hs-cpp">#endif</span>
<a name="line-5"></a><span class="hs-cpp">#if !defined(TESTING) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 703</span>
<a name="line-6"></a><span class="hs-comment">{-# LANGUAGE Trustworthy #-}</span>
<a name="line-7"></a><span class="hs-cpp">#endif</span>
<a name="line-8"></a><span class="hs-comment">-----------------------------------------------------------------------------</span>
<a name="line-9"></a><span class="hs-comment">-- |</span>
<a name="line-10"></a><span class="hs-comment">-- Module      :  Data.Set.Base</span>
<a name="line-11"></a><span class="hs-comment">-- Copyright   :  (c) Daan Leijen 2002</span>
<a name="line-12"></a><span class="hs-comment">-- License     :  BSD-style</span>
<a name="line-13"></a><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span>
<a name="line-14"></a><span class="hs-comment">-- Stability   :  provisional</span>
<a name="line-15"></a><span class="hs-comment">-- Portability :  portable</span>
<a name="line-16"></a><span class="hs-comment">--</span>
<a name="line-17"></a><span class="hs-comment">-- An efficient implementation of sets.</span>
<a name="line-18"></a><span class="hs-comment">--</span>
<a name="line-19"></a><span class="hs-comment">-- These modules are intended to be imported qualified, to avoid name</span>
<a name="line-20"></a><span class="hs-comment">-- clashes with Prelude functions, e.g.</span>
<a name="line-21"></a><span class="hs-comment">--</span>
<a name="line-22"></a><span class="hs-comment">-- &gt;  import Data.Set (Set)</span>
<a name="line-23"></a><span class="hs-comment">-- &gt;  import qualified Data.Set as Set</span>
<a name="line-24"></a><span class="hs-comment">--</span>
<a name="line-25"></a><span class="hs-comment">-- The implementation of 'Set' is based on /size balanced/ binary trees (or</span>
<a name="line-26"></a><span class="hs-comment">-- trees of /bounded balance/) as described by:</span>
<a name="line-27"></a><span class="hs-comment">--</span>
<a name="line-28"></a><span class="hs-comment">--    * Stephen Adams, \&quot;/Efficient sets: a balancing act/\&quot;,</span>
<a name="line-29"></a><span class="hs-comment">--      Journal of Functional Programming 3(4):553-562, October 1993,</span>
<a name="line-30"></a><span class="hs-comment">--      &lt;<a href="http://www.swiss.ai.mit.edu/~adams/BB/">http://www.swiss.ai.mit.edu/~adams/BB/</a>&gt;.</span>
<a name="line-31"></a><span class="hs-comment">--</span>
<a name="line-32"></a><span class="hs-comment">--    * J. Nievergelt and E.M. Reingold,</span>
<a name="line-33"></a><span class="hs-comment">--      \&quot;/Binary search trees of bounded balance/\&quot;,</span>
<a name="line-34"></a><span class="hs-comment">--      SIAM journal of computing 2(1), March 1973.</span>
<a name="line-35"></a><span class="hs-comment">--</span>
<a name="line-36"></a><span class="hs-comment">-- Note that the implementation is /left-biased/ -- the elements of a</span>
<a name="line-37"></a><span class="hs-comment">-- first argument are always preferred to the second, for example in</span>
<a name="line-38"></a><span class="hs-comment">-- 'union' or 'insert'.  Of course, left-biasing can only be observed</span>
<a name="line-39"></a><span class="hs-comment">-- when equality is an equivalence relation instead of structural</span>
<a name="line-40"></a><span class="hs-comment">-- equality.</span>
<a name="line-41"></a><span class="hs-comment">-----------------------------------------------------------------------------</span>
<a name="line-42"></a>
<a name="line-43"></a><span class="hs-comment">-- [Note: Using INLINABLE]</span>
<a name="line-44"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-45"></a><span class="hs-comment">-- It is crucial to the performance that the functions specialize on the Ord</span>
<a name="line-46"></a><span class="hs-comment">-- type when possible. GHC 7.0 and higher does this by itself when it sees th</span>
<a name="line-47"></a><span class="hs-comment">-- unfolding of a function -- that is why all public functions are marked</span>
<a name="line-48"></a><span class="hs-comment">-- INLINABLE (that exposes the unfolding).</span>
<a name="line-49"></a>
<a name="line-50"></a>
<a name="line-51"></a><span class="hs-comment">-- [Note: Using INLINE]</span>
<a name="line-52"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-53"></a><span class="hs-comment">-- For other compilers and GHC pre 7.0, we mark some of the functions INLINE.</span>
<a name="line-54"></a><span class="hs-comment">-- We mark the functions that just navigate down the tree (lookup, insert,</span>
<a name="line-55"></a><span class="hs-comment">-- delete and similar). That navigation code gets inlined and thus specialized</span>
<a name="line-56"></a><span class="hs-comment">-- when possible. There is a price to pay -- code growth. The code INLINED is</span>
<a name="line-57"></a><span class="hs-comment">-- therefore only the tree navigation, all the real work (rebalancing) is not</span>
<a name="line-58"></a><span class="hs-comment">-- INLINED by using a NOINLINE.</span>
<a name="line-59"></a><span class="hs-comment">--</span>
<a name="line-60"></a><span class="hs-comment">-- All methods marked INLINE have to be nonrecursive -- a 'go' function doing</span>
<a name="line-61"></a><span class="hs-comment">-- the real work is provided.</span>
<a name="line-62"></a>
<a name="line-63"></a>
<a name="line-64"></a><span class="hs-comment">-- [Note: Type of local 'go' function]</span>
<a name="line-65"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-66"></a><span class="hs-comment">-- If the local 'go' function uses an Ord class, it sometimes heap-allocates</span>
<a name="line-67"></a><span class="hs-comment">-- the Ord dictionary when the 'go' function does not have explicit type.</span>
<a name="line-68"></a><span class="hs-comment">-- In that case we give 'go' explicit type. But this slightly decrease</span>
<a name="line-69"></a><span class="hs-comment">-- performance, as the resulting 'go' function can float out to top level.</span>
<a name="line-70"></a>
<a name="line-71"></a>
<a name="line-72"></a><span class="hs-comment">-- [Note: Local 'go' functions and capturing]</span>
<a name="line-73"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-74"></a><span class="hs-comment">-- As opposed to IntSet, when 'go' function captures an argument, increased</span>
<a name="line-75"></a><span class="hs-comment">-- heap-allocation can occur: sometimes in a polymorphic function, the 'go'</span>
<a name="line-76"></a><span class="hs-comment">-- floats out of its enclosing function and then it heap-allocates the</span>
<a name="line-77"></a><span class="hs-comment">-- dictionary and the argument. Maybe it floats out too late and strictness</span>
<a name="line-78"></a><span class="hs-comment">-- analyzer cannot see that these could be passed on stack.</span>
<a name="line-79"></a><span class="hs-comment">--</span>
<a name="line-80"></a><span class="hs-comment">-- For example, change 'member' so that its local 'go' function is not passing</span>
<a name="line-81"></a><span class="hs-comment">-- argument x and then look at the resulting code for hedgeInt.</span>
<a name="line-82"></a>
<a name="line-83"></a>
<a name="line-84"></a><span class="hs-comment">-- [Note: Order of constructors]</span>
<a name="line-85"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-86"></a><span class="hs-comment">-- The order of constructors of Set matters when considering performance.</span>
<a name="line-87"></a><span class="hs-comment">-- Currently in GHC 7.0, when type has 2 constructors, a forward conditional</span>
<a name="line-88"></a><span class="hs-comment">-- jump is made when successfully matching second constructor. Successful match</span>
<a name="line-89"></a><span class="hs-comment">-- of first constructor results in the forward jump not taken.</span>
<a name="line-90"></a><span class="hs-comment">-- On GHC 7.0, reordering constructors from Tip | Bin to Bin | Tip</span>
<a name="line-91"></a><span class="hs-comment">-- improves the benchmark by up to 10% on x86.</span>
<a name="line-92"></a>
<a name="line-93"></a><span class="hs-keyword">module</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Set</span><span class="hs-varop">.</span><span class="hs-conid">Base</span> <span class="hs-layout">(</span>
<a name="line-94"></a>            <span class="hs-comment">-- * Set type</span>
<a name="line-95"></a>              <span class="hs-conid">Set</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span>       <span class="hs-comment">-- instance Eq,Ord,Show,Read,Data,Typeable</span>
<a name="line-96"></a>
<a name="line-97"></a>            <span class="hs-comment">-- * Operators</span>
<a name="line-98"></a>            <span class="hs-layout">,</span> <span class="hs-layout">(</span><span class="hs-varop">\\</span><span class="hs-layout">)</span>
<a name="line-99"></a>
<a name="line-100"></a>            <span class="hs-comment">-- * Query</span>
<a name="line-101"></a>            <span class="hs-layout">,</span> <span class="hs-varid">null</span>
<a name="line-102"></a>            <span class="hs-layout">,</span> <span class="hs-varid">size</span>
<a name="line-103"></a>            <span class="hs-layout">,</span> <span class="hs-varid">member</span>
<a name="line-104"></a>            <span class="hs-layout">,</span> <span class="hs-varid">notMember</span>
<a name="line-105"></a>            <span class="hs-layout">,</span> <span class="hs-varid">lookupLT</span>
<a name="line-106"></a>            <span class="hs-layout">,</span> <span class="hs-varid">lookupGT</span>
<a name="line-107"></a>            <span class="hs-layout">,</span> <span class="hs-varid">lookupLE</span>
<a name="line-108"></a>            <span class="hs-layout">,</span> <span class="hs-varid">lookupGE</span>
<a name="line-109"></a>            <span class="hs-layout">,</span> <span class="hs-varid">isSubsetOf</span>
<a name="line-110"></a>            <span class="hs-layout">,</span> <span class="hs-varid">isProperSubsetOf</span>
<a name="line-111"></a>
<a name="line-112"></a>            <span class="hs-comment">-- * Construction</span>
<a name="line-113"></a>            <span class="hs-layout">,</span> <span class="hs-varid">empty</span>
<a name="line-114"></a>            <span class="hs-layout">,</span> <span class="hs-varid">singleton</span>
<a name="line-115"></a>            <span class="hs-layout">,</span> <span class="hs-varid">insert</span>
<a name="line-116"></a>            <span class="hs-layout">,</span> <span class="hs-varid">delete</span>
<a name="line-117"></a>
<a name="line-118"></a>            <span class="hs-comment">-- * Combine</span>
<a name="line-119"></a>            <span class="hs-layout">,</span> <span class="hs-varid">union</span>
<a name="line-120"></a>            <span class="hs-layout">,</span> <span class="hs-varid">unions</span>
<a name="line-121"></a>            <span class="hs-layout">,</span> <span class="hs-varid">difference</span>
<a name="line-122"></a>            <span class="hs-layout">,</span> <span class="hs-varid">intersection</span>
<a name="line-123"></a>
<a name="line-124"></a>            <span class="hs-comment">-- * Filter</span>
<a name="line-125"></a>            <span class="hs-layout">,</span> <span class="hs-varid">filter</span>
<a name="line-126"></a>            <span class="hs-layout">,</span> <span class="hs-varid">partition</span>
<a name="line-127"></a>            <span class="hs-layout">,</span> <span class="hs-varid">split</span>
<a name="line-128"></a>            <span class="hs-layout">,</span> <span class="hs-varid">splitMember</span>
<a name="line-129"></a>
<a name="line-130"></a>            <span class="hs-comment">-- * Map</span>
<a name="line-131"></a>            <span class="hs-layout">,</span> <span class="hs-varid">map</span>
<a name="line-132"></a>            <span class="hs-layout">,</span> <span class="hs-varid">mapMonotonic</span>
<a name="line-133"></a>
<a name="line-134"></a>            <span class="hs-comment">-- * Folds</span>
<a name="line-135"></a>            <span class="hs-layout">,</span> <span class="hs-varid">foldr</span>
<a name="line-136"></a>            <span class="hs-layout">,</span> <span class="hs-varid">foldl</span>
<a name="line-137"></a>            <span class="hs-comment">-- ** Strict folds</span>
<a name="line-138"></a>            <span class="hs-layout">,</span> <span class="hs-varid">foldr'</span>
<a name="line-139"></a>            <span class="hs-layout">,</span> <span class="hs-varid">foldl'</span>
<a name="line-140"></a>            <span class="hs-comment">-- ** Legacy folds</span>
<a name="line-141"></a>            <span class="hs-layout">,</span> <span class="hs-varid">fold</span>
<a name="line-142"></a>
<a name="line-143"></a>            <span class="hs-comment">-- * Min\/Max</span>
<a name="line-144"></a>            <span class="hs-layout">,</span> <span class="hs-varid">findMin</span>
<a name="line-145"></a>            <span class="hs-layout">,</span> <span class="hs-varid">findMax</span>
<a name="line-146"></a>            <span class="hs-layout">,</span> <span class="hs-varid">deleteMin</span>
<a name="line-147"></a>            <span class="hs-layout">,</span> <span class="hs-varid">deleteMax</span>
<a name="line-148"></a>            <span class="hs-layout">,</span> <span class="hs-varid">deleteFindMin</span>
<a name="line-149"></a>            <span class="hs-layout">,</span> <span class="hs-varid">deleteFindMax</span>
<a name="line-150"></a>            <span class="hs-layout">,</span> <span class="hs-varid">maxView</span>
<a name="line-151"></a>            <span class="hs-layout">,</span> <span class="hs-varid">minView</span>
<a name="line-152"></a>
<a name="line-153"></a>            <span class="hs-comment">-- * Conversion</span>
<a name="line-154"></a>
<a name="line-155"></a>            <span class="hs-comment">-- ** List</span>
<a name="line-156"></a>            <span class="hs-layout">,</span> <span class="hs-varid">elems</span>
<a name="line-157"></a>            <span class="hs-layout">,</span> <span class="hs-varid">toList</span>
<a name="line-158"></a>            <span class="hs-layout">,</span> <span class="hs-varid">fromList</span>
<a name="line-159"></a>
<a name="line-160"></a>            <span class="hs-comment">-- ** Ordered list</span>
<a name="line-161"></a>            <span class="hs-layout">,</span> <span class="hs-varid">toAscList</span>
<a name="line-162"></a>            <span class="hs-layout">,</span> <span class="hs-varid">toDescList</span>
<a name="line-163"></a>            <span class="hs-layout">,</span> <span class="hs-varid">fromAscList</span>
<a name="line-164"></a>            <span class="hs-layout">,</span> <span class="hs-varid">fromDistinctAscList</span>
<a name="line-165"></a>
<a name="line-166"></a>            <span class="hs-comment">-- * Debugging</span>
<a name="line-167"></a>            <span class="hs-layout">,</span> <span class="hs-varid">showTree</span>
<a name="line-168"></a>            <span class="hs-layout">,</span> <span class="hs-varid">showTreeWith</span>
<a name="line-169"></a>            <span class="hs-layout">,</span> <span class="hs-varid">valid</span>
<a name="line-170"></a>
<a name="line-171"></a>            <span class="hs-comment">-- Internals (for testing)</span>
<a name="line-172"></a>            <span class="hs-layout">,</span> <span class="hs-varid">bin</span>
<a name="line-173"></a>            <span class="hs-layout">,</span> <span class="hs-varid">balanced</span>
<a name="line-174"></a>            <span class="hs-layout">,</span> <span class="hs-varid">join</span>
<a name="line-175"></a>            <span class="hs-layout">,</span> <span class="hs-varid">merge</span>
<a name="line-176"></a>            <span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-177"></a>
<a name="line-178"></a><span class="hs-keyword">import</span> <span class="hs-conid">Prelude</span> <span class="hs-varid">hiding</span> <span class="hs-layout">(</span><span class="hs-varid">filter</span><span class="hs-layout">,</span><span class="hs-varid">foldl</span><span class="hs-layout">,</span><span class="hs-varid">foldr</span><span class="hs-layout">,</span><span class="hs-varid">null</span><span class="hs-layout">,</span><span class="hs-varid">map</span><span class="hs-layout">)</span>
<a name="line-179"></a><span class="hs-keyword">import</span> <span class="hs-keyword">qualified</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">List</span> <span class="hs-keyword">as</span> <span class="hs-conid">List</span>
<a name="line-180"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Monoid</span> <span class="hs-layout">(</span><span class="hs-conid">Monoid</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-181"></a><span class="hs-keyword">import</span> <span class="hs-keyword">qualified</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Foldable</span> <span class="hs-keyword">as</span> <span class="hs-conid">Foldable</span>
<a name="line-182"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Typeable</span>
<a name="line-183"></a><span class="hs-keyword">import</span> <span class="hs-conid">Control</span><span class="hs-varop">.</span><span class="hs-conid">DeepSeq</span> <span class="hs-layout">(</span><span class="hs-conid">NFData</span><span class="hs-layout">(</span><span class="hs-varid">rnf</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-184"></a>
<a name="line-185"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__</span>
<a name="line-186"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Exts</span> <span class="hs-layout">(</span> <span class="hs-varid">build</span> <span class="hs-layout">)</span>
<a name="line-187"></a><span class="hs-keyword">import</span> <span class="hs-conid">Text</span><span class="hs-varop">.</span><span class="hs-conid">Read</span>
<a name="line-188"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Data</span>
<a name="line-189"></a><span class="hs-cpp">#endif</span>
<a name="line-190"></a>
<a name="line-191"></a><span class="hs-comment">-- Use macros to define strictness of functions.</span>
<a name="line-192"></a><span class="hs-comment">-- STRICT_x_OF_y denotes an y-ary function strict in the x-th parameter.</span>
<a name="line-193"></a><span class="hs-comment">-- We do not use BangPatterns, because they are not in any standard and we</span>
<a name="line-194"></a><span class="hs-comment">-- want the compilers to be compiled by as many compilers as possible.</span>
<a name="line-195"></a><span class="hs-cpp">#define STRICT_1_OF_2(fn) fn arg _ | arg `seq` False = undefined</span>
<a name="line-196"></a><span class="hs-cpp">#define STRICT_1_OF_3(fn) fn arg _ _ | arg `seq` False = undefined</span>
<a name="line-197"></a>
<a name="line-198"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-199"></a>  Operators
<a name="line-200"></a>--------------------------------------------------------------------}</span>
<a name="line-201"></a><span class="hs-keyword">infixl</span> <span class="hs-num">9</span> <span class="hs-varop">\\</span> <span class="hs-comment">--</span>
<a name="line-202"></a>
<a name="line-203"></a><a name="%5c%5c"></a><span class="hs-comment">-- | /O(n+m)/. See 'difference'.</span>
<a name="line-204"></a><span class="hs-layout">(</span><span class="hs-varop">\\</span><span class="hs-layout">)</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-205"></a><a name="m1"></a><span class="hs-definition">m1</span> <span class="hs-varop">\\</span> <span class="hs-varid">m2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">difference</span> <span class="hs-varid">m1</span> <span class="hs-varid">m2</span>
<a name="line-206"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-207"></a><span class="hs-comment">{-# INLINABLE (\\) #-}</span>
<a name="line-208"></a><span class="hs-cpp">#endif</span>
<a name="line-209"></a>
<a name="line-210"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-211"></a>  Sets are size balanced trees
<a name="line-212"></a>--------------------------------------------------------------------}</span>
<a name="line-213"></a><span class="hs-comment">-- | A set of values @a@.</span>
<a name="line-214"></a>
<a name="line-215"></a><a name="Set"></a><span class="hs-comment">-- See Note: Order of constructors</span>
<a name="line-216"></a><a name="Set"></a><span class="hs-keyword">data</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>    <span class="hs-keyglyph">=</span> <span class="hs-conid">Bin</span> <span class="hs-comment">{-# UNPACK #-}</span> <span class="hs-varop">!</span><span class="hs-conid">Size</span> <span class="hs-varop">!</span><span class="hs-varid">a</span> <span class="hs-varop">!</span><span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-varop">!</span><span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-217"></a>              <span class="hs-keyglyph">|</span> <span class="hs-conid">Tip</span>
<a name="line-218"></a>
<a name="line-219"></a><a name="Size"></a><span class="hs-keyword">type</span> <span class="hs-conid">Size</span>     <span class="hs-keyglyph">=</span> <span class="hs-conid">Int</span>
<a name="line-220"></a>
<a name="line-221"></a><a name="instance%20Monoid%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Monoid</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-222"></a>    <span class="hs-varid">mempty</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">empty</span>
<a name="line-223"></a>    <span class="hs-varid">mappend</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">union</span>
<a name="line-224"></a>    <span class="hs-varid">mconcat</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">unions</span>
<a name="line-225"></a>
<a name="line-226"></a><a name="instance%20Foldable.Foldable%20Set"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Foldable</span><span class="hs-varop">.</span><span class="hs-conid">Foldable</span> <span class="hs-conid">Set</span> <span class="hs-keyword">where</span>
<a name="line-227"></a>    <span class="hs-varid">fold</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">mempty</span>
<a name="line-228"></a>    <span class="hs-varid">fold</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">k</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Foldable</span><span class="hs-varop">.</span><span class="hs-varid">fold</span> <span class="hs-varid">l</span> <span class="hs-varop">`mappend`</span> <span class="hs-varid">k</span> <span class="hs-varop">`mappend`</span> <span class="hs-conid">Foldable</span><span class="hs-varop">.</span><span class="hs-varid">fold</span> <span class="hs-varid">r</span>
<a name="line-229"></a>    <span class="hs-varid">foldr</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldr</span>
<a name="line-230"></a>    <span class="hs-varid">foldl</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldl</span>
<a name="line-231"></a>    <span class="hs-varid">foldMap</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">mempty</span>
<a name="line-232"></a>    <span class="hs-varid">foldMap</span> <span class="hs-varid">f</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">k</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Foldable</span><span class="hs-varop">.</span><span class="hs-varid">foldMap</span> <span class="hs-varid">f</span> <span class="hs-varid">l</span> <span class="hs-varop">`mappend`</span> <span class="hs-varid">f</span> <span class="hs-varid">k</span> <span class="hs-varop">`mappend`</span> <span class="hs-conid">Foldable</span><span class="hs-varop">.</span><span class="hs-varid">foldMap</span> <span class="hs-varid">f</span> <span class="hs-varid">r</span>
<a name="line-233"></a>
<a name="line-234"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__</span>
<a name="line-235"></a>
<a name="line-236"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-237"></a>  A Data instance
<a name="line-238"></a>--------------------------------------------------------------------}</span>
<a name="line-239"></a>
<a name="line-240"></a><span class="hs-comment">-- This instance preserves data abstraction at the cost of inefficiency.</span>
<a name="line-241"></a><span class="hs-comment">-- We omit reflection services for the sake of data abstraction.</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="instance%20Data%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">Data</span> <span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Data</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-244"></a>  <span class="hs-varid">gfoldl</span> <span class="hs-varid">f</span> <span class="hs-varid">z</span> <span class="hs-varid">set</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">z</span> <span class="hs-varid">fromList</span> <span class="hs-varop">`f`</span> <span class="hs-layout">(</span><span class="hs-varid">toList</span> <span class="hs-varid">set</span><span class="hs-layout">)</span>
<a name="line-245"></a>  <span class="hs-varid">toConstr</span> <span class="hs-keyword">_</span>     <span class="hs-keyglyph">=</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;toConstr&quot;</span>
<a name="line-246"></a>  <span class="hs-varid">gunfold</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span>    <span class="hs-keyglyph">=</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;gunfold&quot;</span>
<a name="line-247"></a>  <span class="hs-varid">dataTypeOf</span> <span class="hs-keyword">_</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">mkNoRepType</span> <span class="hs-str">&quot;Data.Set.Set&quot;</span>
<a name="line-248"></a>  <span class="hs-varid">dataCast1</span> <span class="hs-varid">f</span>    <span class="hs-keyglyph">=</span> <span class="hs-varid">gcast1</span> <span class="hs-varid">f</span>
<a name="line-249"></a>
<a name="line-250"></a><span class="hs-cpp">#endif</span>
<a name="line-251"></a>
<a name="line-252"></a><a name="null"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-253"></a>  Query
<a name="line-254"></a>--------------------------------------------------------------------}</span>
<a name="line-255"></a><span class="hs-comment">-- | /O(1)/. Is this the empty set?</span>
<a name="line-256"></a><span class="hs-definition">null</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-257"></a><span class="hs-definition">null</span> <span class="hs-conid">Tip</span>      <span class="hs-keyglyph">=</span> <span class="hs-conid">True</span>
<a name="line-258"></a><span class="hs-definition">null</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">{</span><span class="hs-layout">}</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">False</span>
<a name="line-259"></a><span class="hs-comment">{-# INLINE null #-}</span>
<a name="line-260"></a>
<a name="line-261"></a><a name="size"></a><span class="hs-comment">-- | /O(1)/. The number of elements in the set.</span>
<a name="line-262"></a><span class="hs-definition">size</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Int</span>
<a name="line-263"></a><span class="hs-definition">size</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-num">0</span>
<a name="line-264"></a><span class="hs-definition">size</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sz</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">sz</span>
<a name="line-265"></a><span class="hs-comment">{-# INLINE size #-}</span>
<a name="line-266"></a>
<a name="line-267"></a><a name="member"></a><span class="hs-comment">-- | /O(log n)/. Is the element in the set?</span>
<a name="line-268"></a><span class="hs-definition">member</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-269"></a><span class="hs-definition">member</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span>
<a name="line-270"></a>  <span class="hs-keyword">where</span>
<a name="line-271"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">go</span><span class="hs-layout">)</span>
<a name="line-272"></a>    <span class="hs-varid">go</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">False</span>
<a name="line-273"></a>    <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span>
<a name="line-274"></a>      <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span>
<a name="line-275"></a>      <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span>
<a name="line-276"></a>      <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">True</span>
<a name="line-277"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-278"></a><span class="hs-comment">{-# INLINABLE member #-}</span>
<a name="line-279"></a><span class="hs-cpp">#else</span>
<a name="line-280"></a><span class="hs-comment">{-# INLINE member #-}</span>
<a name="line-281"></a><span class="hs-cpp">#endif</span>
<a name="line-282"></a>
<a name="line-283"></a><a name="notMember"></a><span class="hs-comment">-- | /O(log n)/. Is the element not in the set?</span>
<a name="line-284"></a><span class="hs-definition">notMember</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-285"></a><span class="hs-definition">notMember</span> <span class="hs-varid">a</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">not</span> <span class="hs-varop">$</span> <span class="hs-varid">member</span> <span class="hs-varid">a</span> <span class="hs-varid">t</span>
<a name="line-286"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-287"></a><span class="hs-comment">{-# INLINABLE notMember #-}</span>
<a name="line-288"></a><span class="hs-cpp">#else</span>
<a name="line-289"></a><span class="hs-comment">{-# INLINE notMember #-}</span>
<a name="line-290"></a><span class="hs-cpp">#endif</span>
<a name="line-291"></a>
<a name="line-292"></a><a name="lookupLT"></a><span class="hs-comment">-- | /O(log n)/. Find largest element smaller than the given one.</span>
<a name="line-293"></a><span class="hs-comment">--</span>
<a name="line-294"></a><span class="hs-comment">-- &gt; lookupLT 3 (fromList [3, 5]) == Nothing</span>
<a name="line-295"></a><span class="hs-comment">-- &gt; lookupLT 5 (fromList [3, 5]) == Just 3</span>
<a name="line-296"></a><span class="hs-definition">lookupLT</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-varid">a</span>
<a name="line-297"></a><span class="hs-definition">lookupLT</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goNothing</span>
<a name="line-298"></a>  <span class="hs-keyword">where</span>
<a name="line-299"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">goNothing</span><span class="hs-layout">)</span>
<a name="line-300"></a>    <span class="hs-varid">goNothing</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Nothing</span>
<a name="line-301"></a>    <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">y</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span>
<a name="line-302"></a>                              <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">r</span>
<a name="line-303"></a>
<a name="line-304"></a>    <span class="hs-conid">STRICT_1_OF_3</span><span class="hs-layout">(</span><span class="hs-varid">goJust</span><span class="hs-layout">)</span>
<a name="line-305"></a>    <span class="hs-varid">goJust</span> <span class="hs-keyword">_</span> <span class="hs-varid">best</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Just</span> <span class="hs-varid">best</span>
<a name="line-306"></a>    <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">y</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-varid">l</span>
<a name="line-307"></a>                                <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">r</span>
<a name="line-308"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-309"></a><span class="hs-comment">{-# INLINABLE lookupLT #-}</span>
<a name="line-310"></a><span class="hs-cpp">#else</span>
<a name="line-311"></a><span class="hs-comment">{-# INLINE lookupLT #-}</span>
<a name="line-312"></a><span class="hs-cpp">#endif</span>
<a name="line-313"></a>
<a name="line-314"></a><a name="lookupGT"></a><span class="hs-comment">-- | /O(log n)/. Find smallest element greater than the given one.</span>
<a name="line-315"></a><span class="hs-comment">--</span>
<a name="line-316"></a><span class="hs-comment">-- &gt; lookupGT 4 (fromList [3, 5]) == Just 5</span>
<a name="line-317"></a><span class="hs-comment">-- &gt; lookupGT 5 (fromList [3, 5]) == Nothing</span>
<a name="line-318"></a><span class="hs-definition">lookupGT</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-varid">a</span>
<a name="line-319"></a><span class="hs-definition">lookupGT</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goNothing</span>
<a name="line-320"></a>  <span class="hs-keyword">where</span>
<a name="line-321"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">goNothing</span><span class="hs-layout">)</span>
<a name="line-322"></a>    <span class="hs-varid">goNothing</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Nothing</span>
<a name="line-323"></a>    <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">y</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span>
<a name="line-324"></a>                              <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span>
<a name="line-325"></a>
<a name="line-326"></a>    <span class="hs-conid">STRICT_1_OF_3</span><span class="hs-layout">(</span><span class="hs-varid">goJust</span><span class="hs-layout">)</span>
<a name="line-327"></a>    <span class="hs-varid">goJust</span> <span class="hs-keyword">_</span> <span class="hs-varid">best</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Just</span> <span class="hs-varid">best</span>
<a name="line-328"></a>    <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">y</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span>
<a name="line-329"></a>                                <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-varid">r</span>
<a name="line-330"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-331"></a><span class="hs-comment">{-# INLINABLE lookupGT #-}</span>
<a name="line-332"></a><span class="hs-cpp">#else</span>
<a name="line-333"></a><span class="hs-comment">{-# INLINE lookupGT #-}</span>
<a name="line-334"></a><span class="hs-cpp">#endif</span>
<a name="line-335"></a>
<a name="line-336"></a><a name="lookupLE"></a><span class="hs-comment">-- | /O(log n)/. Find largest element smaller or equal to the given one.</span>
<a name="line-337"></a><span class="hs-comment">--</span>
<a name="line-338"></a><span class="hs-comment">-- &gt; lookupLE 2 (fromList [3, 5]) == Nothing</span>
<a name="line-339"></a><span class="hs-comment">-- &gt; lookupLE 4 (fromList [3, 5]) == Just 3</span>
<a name="line-340"></a><span class="hs-comment">-- &gt; lookupLE 5 (fromList [3, 5]) == Just 5</span>
<a name="line-341"></a><span class="hs-definition">lookupLE</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-varid">a</span>
<a name="line-342"></a><span class="hs-definition">lookupLE</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goNothing</span>
<a name="line-343"></a>  <span class="hs-keyword">where</span>
<a name="line-344"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">goNothing</span><span class="hs-layout">)</span>
<a name="line-345"></a>    <span class="hs-varid">goNothing</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Nothing</span>
<a name="line-346"></a>    <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span> <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span>
<a name="line-347"></a>                                                    <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Just</span> <span class="hs-varid">y</span>
<a name="line-348"></a>                                                    <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">r</span>
<a name="line-349"></a>
<a name="line-350"></a>    <span class="hs-conid">STRICT_1_OF_3</span><span class="hs-layout">(</span><span class="hs-varid">goJust</span><span class="hs-layout">)</span>
<a name="line-351"></a>    <span class="hs-varid">goJust</span> <span class="hs-keyword">_</span> <span class="hs-varid">best</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Just</span> <span class="hs-varid">best</span>
<a name="line-352"></a>    <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span> <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-varid">l</span>
<a name="line-353"></a>                                                      <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Just</span> <span class="hs-varid">y</span>
<a name="line-354"></a>                                                      <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">r</span>
<a name="line-355"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-356"></a><span class="hs-comment">{-# INLINABLE lookupLE #-}</span>
<a name="line-357"></a><span class="hs-cpp">#else</span>
<a name="line-358"></a><span class="hs-comment">{-# INLINE lookupLE #-}</span>
<a name="line-359"></a><span class="hs-cpp">#endif</span>
<a name="line-360"></a>
<a name="line-361"></a><a name="lookupGE"></a><span class="hs-comment">-- | /O(log n)/. Find smallest element greater or equal to the given one.</span>
<a name="line-362"></a><span class="hs-comment">--</span>
<a name="line-363"></a><span class="hs-comment">-- &gt; lookupGE 3 (fromList [3, 5]) == Just 3</span>
<a name="line-364"></a><span class="hs-comment">-- &gt; lookupGE 4 (fromList [3, 5]) == Just 5</span>
<a name="line-365"></a><span class="hs-comment">-- &gt; lookupGE 6 (fromList [3, 5]) == Nothing</span>
<a name="line-366"></a><span class="hs-definition">lookupGE</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-varid">a</span>
<a name="line-367"></a><span class="hs-definition">lookupGE</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">goNothing</span>
<a name="line-368"></a>  <span class="hs-keyword">where</span>
<a name="line-369"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">goNothing</span><span class="hs-layout">)</span>
<a name="line-370"></a>    <span class="hs-varid">goNothing</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Nothing</span>
<a name="line-371"></a>    <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span> <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span>
<a name="line-372"></a>                                                    <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Just</span> <span class="hs-varid">y</span>
<a name="line-373"></a>                                                    <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goNothing</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span>
<a name="line-374"></a>
<a name="line-375"></a>    <span class="hs-conid">STRICT_1_OF_3</span><span class="hs-layout">(</span><span class="hs-varid">goJust</span><span class="hs-layout">)</span>
<a name="line-376"></a>    <span class="hs-varid">goJust</span> <span class="hs-keyword">_</span> <span class="hs-varid">best</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Just</span> <span class="hs-varid">best</span>
<a name="line-377"></a>    <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span> <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span>
<a name="line-378"></a>                                                      <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Just</span> <span class="hs-varid">y</span>
<a name="line-379"></a>                                                      <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">goJust</span> <span class="hs-varid">x</span> <span class="hs-varid">best</span> <span class="hs-varid">r</span>
<a name="line-380"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-381"></a><span class="hs-comment">{-# INLINABLE lookupGE #-}</span>
<a name="line-382"></a><span class="hs-cpp">#else</span>
<a name="line-383"></a><span class="hs-comment">{-# INLINE lookupGE #-}</span>
<a name="line-384"></a><span class="hs-cpp">#endif</span>
<a name="line-385"></a>
<a name="line-386"></a><a name="empty"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-387"></a>  Construction
<a name="line-388"></a>--------------------------------------------------------------------}</span>
<a name="line-389"></a><span class="hs-comment">-- | /O(1)/. The empty set.</span>
<a name="line-390"></a><span class="hs-definition">empty</span>  <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-391"></a><span class="hs-definition">empty</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-392"></a><span class="hs-comment">{-# INLINE empty #-}</span>
<a name="line-393"></a>
<a name="line-394"></a><a name="singleton"></a><span class="hs-comment">-- | /O(1)/. Create a singleton set.</span>
<a name="line-395"></a><span class="hs-definition">singleton</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-396"></a><span class="hs-definition">singleton</span> <span class="hs-varid">x</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span>
<a name="line-397"></a><span class="hs-comment">{-# INLINE singleton #-}</span>
<a name="line-398"></a>
<a name="line-399"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-400"></a>  Insertion, Deletion
<a name="line-401"></a>--------------------------------------------------------------------}</span>
<a name="line-402"></a><span class="hs-comment">-- | /O(log n)/. Insert an element in a set.</span>
<a name="line-403"></a><span class="hs-comment">-- If the set already contains an element equal to the given value,</span>
<a name="line-404"></a><span class="hs-comment">-- it is replaced with the new value.</span>
<a name="line-405"></a>
<a name="line-406"></a><a name="insert"></a><span class="hs-comment">-- See Note: Type of local 'go' function</span>
<a name="line-407"></a><span class="hs-definition">insert</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-408"></a><span class="hs-definition">insert</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span>
<a name="line-409"></a>  <span class="hs-keyword">where</span>
<a name="line-410"></a>    <span class="hs-varid">go</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-411"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">go</span><span class="hs-layout">)</span>
<a name="line-412"></a>    <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">singleton</span> <span class="hs-varid">x</span>
<a name="line-413"></a>    <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sz</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span>
<a name="line-414"></a>        <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">y</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-415"></a>        <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-416"></a>        <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-varid">sz</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-417"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-418"></a><span class="hs-comment">{-# INLINABLE insert #-}</span>
<a name="line-419"></a><span class="hs-cpp">#else</span>
<a name="line-420"></a><span class="hs-comment">{-# INLINE insert #-}</span>
<a name="line-421"></a><span class="hs-cpp">#endif</span>
<a name="line-422"></a>
<a name="line-423"></a><span class="hs-comment">-- Insert an element to the set only if it is not in the set.</span>
<a name="line-424"></a><span class="hs-comment">-- Used by `union`.</span>
<a name="line-425"></a>
<a name="line-426"></a><a name="insertR"></a><span class="hs-comment">-- See Note: Type of local 'go' function</span>
<a name="line-427"></a><span class="hs-definition">insertR</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-428"></a><span class="hs-definition">insertR</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span>
<a name="line-429"></a>  <span class="hs-keyword">where</span>
<a name="line-430"></a>    <span class="hs-varid">go</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-431"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">go</span><span class="hs-layout">)</span>
<a name="line-432"></a>    <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">singleton</span> <span class="hs-varid">x</span>
<a name="line-433"></a>    <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">t</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span>
<a name="line-434"></a>        <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">y</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-435"></a>        <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-436"></a>        <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">t</span>
<a name="line-437"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-438"></a><span class="hs-comment">{-# INLINABLE insertR #-}</span>
<a name="line-439"></a><span class="hs-cpp">#else</span>
<a name="line-440"></a><span class="hs-comment">{-# INLINE insertR #-}</span>
<a name="line-441"></a><span class="hs-cpp">#endif</span>
<a name="line-442"></a>
<a name="line-443"></a><span class="hs-comment">-- | /O(log n)/. Delete an element from a set.</span>
<a name="line-444"></a>
<a name="line-445"></a><a name="delete"></a><span class="hs-comment">-- See Note: Type of local 'go' function</span>
<a name="line-446"></a><span class="hs-definition">delete</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-447"></a><span class="hs-definition">delete</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span>
<a name="line-448"></a>  <span class="hs-keyword">where</span>
<a name="line-449"></a>    <span class="hs-varid">go</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-450"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">go</span><span class="hs-layout">)</span>
<a name="line-451"></a>    <span class="hs-varid">go</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-452"></a>    <span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span>
<a name="line-453"></a>        <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">y</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-454"></a>        <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-455"></a>        <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">glue</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-456"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-457"></a><span class="hs-comment">{-# INLINABLE delete #-}</span>
<a name="line-458"></a><span class="hs-cpp">#else</span>
<a name="line-459"></a><span class="hs-comment">{-# INLINE delete #-}</span>
<a name="line-460"></a><span class="hs-cpp">#endif</span>
<a name="line-461"></a>
<a name="line-462"></a><a name="isProperSubsetOf"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-463"></a>  Subset
<a name="line-464"></a>--------------------------------------------------------------------}</span>
<a name="line-465"></a><span class="hs-comment">-- | /O(n+m)/. Is this a proper subset? (ie. a subset but not equal).</span>
<a name="line-466"></a><span class="hs-definition">isProperSubsetOf</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-467"></a><span class="hs-definition">isProperSubsetOf</span> <span class="hs-varid">s1</span> <span class="hs-varid">s2</span>
<a name="line-468"></a>    <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">s1</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">size</span> <span class="hs-varid">s2</span><span class="hs-layout">)</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-layout">(</span><span class="hs-varid">isSubsetOf</span> <span class="hs-varid">s1</span> <span class="hs-varid">s2</span><span class="hs-layout">)</span>
<a name="line-469"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-470"></a><span class="hs-comment">{-# INLINABLE isProperSubsetOf #-}</span>
<a name="line-471"></a><span class="hs-cpp">#endif</span>
<a name="line-472"></a>
<a name="line-473"></a>
<a name="line-474"></a><a name="isSubsetOf"></a><span class="hs-comment">-- | /O(n+m)/. Is this a subset?</span>
<a name="line-475"></a><span class="hs-comment">-- @(s1 `isSubsetOf` s2)@ tells whether @s1@ is a subset of @s2@.</span>
<a name="line-476"></a><span class="hs-definition">isSubsetOf</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-477"></a><span class="hs-definition">isSubsetOf</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span>
<a name="line-478"></a>  <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">t1</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">size</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-layout">(</span><span class="hs-varid">isSubsetOfX</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span>
<a name="line-479"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-480"></a><span class="hs-comment">{-# INLINABLE isSubsetOf #-}</span>
<a name="line-481"></a><span class="hs-cpp">#endif</span>
<a name="line-482"></a>
<a name="line-483"></a><a name="isSubsetOfX"></a><span class="hs-definition">isSubsetOfX</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-484"></a><span class="hs-definition">isSubsetOfX</span> <span class="hs-conid">Tip</span> <span class="hs-keyword">_</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">True</span>
<a name="line-485"></a><span class="hs-definition">isSubsetOfX</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">False</span>
<a name="line-486"></a><span class="hs-definition">isSubsetOfX</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-varid">t</span>
<a name="line-487"></a>  <span class="hs-keyglyph">=</span> <span class="hs-varid">found</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">isSubsetOfX</span> <span class="hs-varid">l</span> <span class="hs-varid">lt</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">isSubsetOfX</span> <span class="hs-varid">r</span> <span class="hs-varid">gt</span>
<a name="line-488"></a>  <span class="hs-keyword">where</span>
<a name="line-489"></a>    <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span><span class="hs-varid">found</span><span class="hs-layout">,</span><span class="hs-varid">gt</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">splitMember</span> <span class="hs-varid">x</span> <span class="hs-varid">t</span>
<a name="line-490"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-491"></a><span class="hs-comment">{-# INLINABLE isSubsetOfX #-}</span>
<a name="line-492"></a><span class="hs-cpp">#endif</span>
<a name="line-493"></a>
<a name="line-494"></a>
<a name="line-495"></a><a name="findMin"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-496"></a>  Minimal, Maximal
<a name="line-497"></a>--------------------------------------------------------------------}</span>
<a name="line-498"></a><span class="hs-comment">-- | /O(log n)/. The minimal element of a set.</span>
<a name="line-499"></a><span class="hs-definition">findMin</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span>
<a name="line-500"></a><span class="hs-definition">findMin</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">x</span>
<a name="line-501"></a><span class="hs-definition">findMin</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-varid">l</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">findMin</span> <span class="hs-varid">l</span>
<a name="line-502"></a><span class="hs-definition">findMin</span> <span class="hs-conid">Tip</span>             <span class="hs-keyglyph">=</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;Set.findMin: empty set has no minimal element&quot;</span>
<a name="line-503"></a>
<a name="line-504"></a><a name="findMax"></a><span class="hs-comment">-- | /O(log n)/. The maximal element of a set.</span>
<a name="line-505"></a><span class="hs-definition">findMax</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span>
<a name="line-506"></a><span class="hs-definition">findMax</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">x</span>
<a name="line-507"></a><span class="hs-definition">findMax</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>    <span class="hs-keyglyph">=</span> <span class="hs-varid">findMax</span> <span class="hs-varid">r</span>
<a name="line-508"></a><span class="hs-definition">findMax</span> <span class="hs-conid">Tip</span>              <span class="hs-keyglyph">=</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;Set.findMax: empty set has no maximal element&quot;</span>
<a name="line-509"></a>
<a name="line-510"></a><a name="deleteMin"></a><span class="hs-comment">-- | /O(log n)/. Delete the minimal element.</span>
<a name="line-511"></a><span class="hs-definition">deleteMin</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-512"></a><span class="hs-definition">deleteMin</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">r</span>
<a name="line-513"></a><span class="hs-definition">deleteMin</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">deleteMin</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-514"></a><span class="hs-definition">deleteMin</span> <span class="hs-conid">Tip</span>             <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-515"></a>
<a name="line-516"></a><a name="deleteMax"></a><span class="hs-comment">-- | /O(log n)/. Delete the maximal element.</span>
<a name="line-517"></a><span class="hs-definition">deleteMax</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-518"></a><span class="hs-definition">deleteMax</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">l</span>
<a name="line-519"></a><span class="hs-definition">deleteMax</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">deleteMax</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-520"></a><span class="hs-definition">deleteMax</span> <span class="hs-conid">Tip</span>             <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-521"></a>
<a name="line-522"></a><a name="unions"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-523"></a>  Union.
<a name="line-524"></a>--------------------------------------------------------------------}</span>
<a name="line-525"></a><span class="hs-comment">-- | The union of a list of sets: (@'unions' == 'foldl' 'union' 'empty'@).</span>
<a name="line-526"></a><span class="hs-definition">unions</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-527"></a><span class="hs-definition">unions</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldlStrict</span> <span class="hs-varid">union</span> <span class="hs-varid">empty</span>
<a name="line-528"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-529"></a><span class="hs-comment">{-# INLINABLE unions #-}</span>
<a name="line-530"></a><span class="hs-cpp">#endif</span>
<a name="line-531"></a>
<a name="line-532"></a><a name="union"></a><span class="hs-comment">-- | /O(n+m)/. The union of two sets, preferring the first set when</span>
<a name="line-533"></a><span class="hs-comment">-- equal elements are encountered.</span>
<a name="line-534"></a><span class="hs-comment">-- The implementation uses the efficient /hedge-union/ algorithm.</span>
<a name="line-535"></a><span class="hs-comment">-- Hedge-union is more efficient on (bigset `union` smallset).</span>
<a name="line-536"></a><span class="hs-definition">union</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-537"></a><span class="hs-definition">union</span> <span class="hs-conid">Tip</span> <span class="hs-varid">t2</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">t2</span>
<a name="line-538"></a><span class="hs-definition">union</span> <span class="hs-varid">t1</span> <span class="hs-conid">Tip</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">t1</span>
<a name="line-539"></a><span class="hs-definition">union</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">hedgeUnion</span> <span class="hs-conid">NothingS</span> <span class="hs-conid">NothingS</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span>
<a name="line-540"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-541"></a><span class="hs-comment">{-# INLINABLE union #-}</span>
<a name="line-542"></a><span class="hs-cpp">#endif</span>
<a name="line-543"></a>
<a name="line-544"></a><a name="hedgeUnion"></a><span class="hs-definition">hedgeUnion</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-545"></a><span class="hs-definition">hedgeUnion</span> <span class="hs-keyword">_</span>   <span class="hs-keyword">_</span>   <span class="hs-varid">t1</span>  <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t1</span>
<a name="line-546"></a><span class="hs-definition">hedgeUnion</span> <span class="hs-varid">blo</span> <span class="hs-varid">bhi</span> <span class="hs-conid">Tip</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">filterGt</span> <span class="hs-varid">blo</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">filterLt</span> <span class="hs-varid">bhi</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-547"></a><span class="hs-definition">hedgeUnion</span> <span class="hs-keyword">_</span>   <span class="hs-keyword">_</span>   <span class="hs-varid">t1</span>  <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">insertR</span> <span class="hs-varid">x</span> <span class="hs-varid">t1</span>   <span class="hs-comment">-- According to benchmarks, this special case increases</span>
<a name="line-548"></a>                                                          <span class="hs-comment">-- performance up to 30%. It does not help in difference or intersection.</span>
<a name="line-549"></a><span class="hs-definition">hedgeUnion</span> <span class="hs-varid">blo</span> <span class="hs-varid">bhi</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-varid">t2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">hedgeUnion</span> <span class="hs-varid">blo</span> <span class="hs-varid">bmi</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">trim</span> <span class="hs-varid">blo</span> <span class="hs-varid">bmi</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-550"></a>                                             <span class="hs-layout">(</span><span class="hs-varid">hedgeUnion</span> <span class="hs-varid">bmi</span> <span class="hs-varid">bhi</span> <span class="hs-varid">r</span> <span class="hs-layout">(</span><span class="hs-varid">trim</span> <span class="hs-varid">bmi</span> <span class="hs-varid">bhi</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-551"></a>  <span class="hs-keyword">where</span> <span class="hs-varid">bmi</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">JustS</span> <span class="hs-varid">x</span>
<a name="line-552"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-553"></a><span class="hs-comment">{-# INLINABLE hedgeUnion #-}</span>
<a name="line-554"></a><span class="hs-cpp">#endif</span>
<a name="line-555"></a>
<a name="line-556"></a><a name="difference"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-557"></a>  Difference
<a name="line-558"></a>--------------------------------------------------------------------}</span>
<a name="line-559"></a><span class="hs-comment">-- | /O(n+m)/. Difference of two sets.</span>
<a name="line-560"></a><span class="hs-comment">-- The implementation uses an efficient /hedge/ algorithm comparable with /hedge-union/.</span>
<a name="line-561"></a><span class="hs-definition">difference</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-562"></a><span class="hs-definition">difference</span> <span class="hs-conid">Tip</span> <span class="hs-keyword">_</span>   <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-563"></a><span class="hs-definition">difference</span> <span class="hs-varid">t1</span> <span class="hs-conid">Tip</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">t1</span>
<a name="line-564"></a><span class="hs-definition">difference</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">hedgeDiff</span> <span class="hs-conid">NothingS</span> <span class="hs-conid">NothingS</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span>
<a name="line-565"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-566"></a><span class="hs-comment">{-# INLINABLE difference #-}</span>
<a name="line-567"></a><span class="hs-cpp">#endif</span>
<a name="line-568"></a>
<a name="line-569"></a><a name="hedgeDiff"></a><span class="hs-definition">hedgeDiff</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-570"></a><span class="hs-definition">hedgeDiff</span> <span class="hs-keyword">_</span>   <span class="hs-keyword">_</span>   <span class="hs-conid">Tip</span>           <span class="hs-keyword">_</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-571"></a><span class="hs-definition">hedgeDiff</span> <span class="hs-varid">blo</span> <span class="hs-varid">bhi</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">filterGt</span> <span class="hs-varid">blo</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">filterLt</span> <span class="hs-varid">bhi</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-572"></a><span class="hs-definition">hedgeDiff</span> <span class="hs-varid">blo</span> <span class="hs-varid">bhi</span> <span class="hs-varid">t</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">merge</span> <span class="hs-layout">(</span><span class="hs-varid">hedgeDiff</span> <span class="hs-varid">blo</span> <span class="hs-varid">bmi</span> <span class="hs-layout">(</span><span class="hs-varid">trim</span> <span class="hs-varid">blo</span> <span class="hs-varid">bmi</span> <span class="hs-varid">t</span><span class="hs-layout">)</span> <span class="hs-varid">l</span><span class="hs-layout">)</span>
<a name="line-573"></a>                                          <span class="hs-layout">(</span><span class="hs-varid">hedgeDiff</span> <span class="hs-varid">bmi</span> <span class="hs-varid">bhi</span> <span class="hs-layout">(</span><span class="hs-varid">trim</span> <span class="hs-varid">bmi</span> <span class="hs-varid">bhi</span> <span class="hs-varid">t</span><span class="hs-layout">)</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-574"></a>  <span class="hs-keyword">where</span> <span class="hs-varid">bmi</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">JustS</span> <span class="hs-varid">x</span>
<a name="line-575"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-576"></a><span class="hs-comment">{-# INLINABLE hedgeDiff #-}</span>
<a name="line-577"></a><span class="hs-cpp">#endif</span>
<a name="line-578"></a>
<a name="line-579"></a><a name="intersection"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-580"></a>  Intersection
<a name="line-581"></a>--------------------------------------------------------------------}</span>
<a name="line-582"></a><span class="hs-comment">-- | /O(n+m)/. The intersection of two sets.</span>
<a name="line-583"></a><span class="hs-comment">-- Elements of the result come from the first set, so for example</span>
<a name="line-584"></a><span class="hs-comment">--</span>
<a name="line-585"></a><span class="hs-comment">-- &gt; import qualified Data.Set as S</span>
<a name="line-586"></a><span class="hs-comment">-- &gt; data AB = A | B deriving Show</span>
<a name="line-587"></a><span class="hs-comment">-- &gt; instance Ord AB where compare _ _ = EQ</span>
<a name="line-588"></a><span class="hs-comment">-- &gt; instance Eq AB where _ == _ = True</span>
<a name="line-589"></a><span class="hs-comment">-- &gt; main = print (S.singleton A `S.intersection` S.singleton B,</span>
<a name="line-590"></a><span class="hs-comment">-- &gt;               S.singleton B `S.intersection` S.singleton A)</span>
<a name="line-591"></a><span class="hs-comment">--</span>
<a name="line-592"></a><span class="hs-comment">-- prints @(fromList [A],fromList [B])@.</span>
<a name="line-593"></a><span class="hs-definition">intersection</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-594"></a><span class="hs-definition">intersection</span> <span class="hs-conid">Tip</span> <span class="hs-keyword">_</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-595"></a><span class="hs-definition">intersection</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-596"></a><span class="hs-definition">intersection</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">hedgeInt</span> <span class="hs-conid">NothingS</span> <span class="hs-conid">NothingS</span> <span class="hs-varid">t1</span> <span class="hs-varid">t2</span>
<a name="line-597"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-598"></a><span class="hs-comment">{-# INLINABLE intersection #-}</span>
<a name="line-599"></a><span class="hs-cpp">#endif</span>
<a name="line-600"></a>
<a name="line-601"></a><a name="hedgeInt"></a><span class="hs-definition">hedgeInt</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-602"></a><span class="hs-definition">hedgeInt</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span>   <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-603"></a><span class="hs-definition">hedgeInt</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyword">_</span>   <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-604"></a><span class="hs-definition">hedgeInt</span> <span class="hs-varid">blo</span> <span class="hs-varid">bhi</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-varid">t2</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">let</span> <span class="hs-varid">l'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">hedgeInt</span> <span class="hs-varid">blo</span> <span class="hs-varid">bmi</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">trim</span> <span class="hs-varid">blo</span> <span class="hs-varid">bmi</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span>
<a name="line-605"></a>                                        <span class="hs-varid">r'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">hedgeInt</span> <span class="hs-varid">bmi</span> <span class="hs-varid">bhi</span> <span class="hs-varid">r</span> <span class="hs-layout">(</span><span class="hs-varid">trim</span> <span class="hs-varid">bmi</span> <span class="hs-varid">bhi</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span>
<a name="line-606"></a>                                    <span class="hs-keyword">in</span> <span class="hs-keyword">if</span> <span class="hs-varid">x</span> <span class="hs-varop">`member`</span> <span class="hs-varid">t2</span> <span class="hs-keyword">then</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l'</span> <span class="hs-varid">r'</span> <span class="hs-keyword">else</span> <span class="hs-varid">merge</span> <span class="hs-varid">l'</span> <span class="hs-varid">r'</span>
<a name="line-607"></a>  <span class="hs-keyword">where</span> <span class="hs-varid">bmi</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">JustS</span> <span class="hs-varid">x</span>
<a name="line-608"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-609"></a><span class="hs-comment">{-# INLINABLE hedgeInt #-}</span>
<a name="line-610"></a><span class="hs-cpp">#endif</span>
<a name="line-611"></a>
<a name="line-612"></a><a name="filter"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-613"></a>  Filter and partition
<a name="line-614"></a>--------------------------------------------------------------------}</span>
<a name="line-615"></a><span class="hs-comment">-- | /O(n)/. Filter all elements that satisfy the predicate.</span>
<a name="line-616"></a><span class="hs-definition">filter</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-617"></a><span class="hs-definition">filter</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-618"></a><span class="hs-definition">filter</span> <span class="hs-varid">p</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-619"></a>    <span class="hs-keyglyph">|</span> <span class="hs-varid">p</span> <span class="hs-varid">x</span>       <span class="hs-keyglyph">=</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">filter</span> <span class="hs-varid">p</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">filter</span> <span class="hs-varid">p</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-620"></a>    <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">merge</span> <span class="hs-layout">(</span><span class="hs-varid">filter</span> <span class="hs-varid">p</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">filter</span> <span class="hs-varid">p</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-621"></a>
<a name="line-622"></a><a name="partition"></a><span class="hs-comment">-- | /O(n)/. Partition the set into two sets, one with all elements that satisfy</span>
<a name="line-623"></a><span class="hs-comment">-- the predicate and one with all elements that don't satisfy the predicate.</span>
<a name="line-624"></a><span class="hs-comment">-- See also 'split'.</span>
<a name="line-625"></a><span class="hs-definition">partition</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">,</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-626"></a><span class="hs-definition">partition</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-conid">Tip</span><span class="hs-layout">,</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-627"></a><span class="hs-definition">partition</span> <span class="hs-varid">p</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-layout">(</span><span class="hs-varid">partition</span> <span class="hs-varid">p</span> <span class="hs-varid">l</span><span class="hs-layout">,</span> <span class="hs-varid">partition</span> <span class="hs-varid">p</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyword">of</span>
<a name="line-628"></a>  <span class="hs-layout">(</span><span class="hs-layout">(</span><span class="hs-varid">l1</span><span class="hs-layout">,</span> <span class="hs-varid">l2</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-layout">(</span><span class="hs-varid">r1</span><span class="hs-layout">,</span> <span class="hs-varid">r2</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-629"></a>    <span class="hs-keyglyph">|</span> <span class="hs-varid">p</span> <span class="hs-varid">x</span>       <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l1</span> <span class="hs-varid">r1</span><span class="hs-layout">,</span> <span class="hs-varid">merge</span> <span class="hs-varid">l2</span> <span class="hs-varid">r2</span><span class="hs-layout">)</span>
<a name="line-630"></a>    <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">merge</span> <span class="hs-varid">l1</span> <span class="hs-varid">r1</span><span class="hs-layout">,</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l2</span> <span class="hs-varid">r2</span><span class="hs-layout">)</span>
<a name="line-631"></a>
<a name="line-632"></a><span class="hs-comment">{----------------------------------------------------------------------
<a name="line-633"></a>  Map
<a name="line-634"></a>----------------------------------------------------------------------}</span>
<a name="line-635"></a>
<a name="line-636"></a><span class="hs-comment">-- | /O(n*log n)/.</span>
<a name="line-637"></a><span class="hs-comment">-- @'map' f s@ is the set obtained by applying @f@ to each element of @s@.</span>
<a name="line-638"></a><span class="hs-comment">--</span>
<a name="line-639"></a><span class="hs-comment">-- It's worth noting that the size of the result may be smaller if,</span>
<a name="line-640"></a><span class="hs-comment">-- for some @(x,y)@, @x \/= y &amp;&amp; f x == f y@</span>
<a name="line-641"></a>
<a name="line-642"></a><a name="map"></a><span class="hs-definition">map</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-conid">Ord</span> <span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">Ord</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-keyglyph">-&gt;</span><span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">b</span>
<a name="line-643"></a><span class="hs-definition">map</span> <span class="hs-varid">f</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">fromList</span> <span class="hs-varop">.</span> <span class="hs-conid">List</span><span class="hs-varop">.</span><span class="hs-varid">map</span> <span class="hs-varid">f</span> <span class="hs-varop">.</span> <span class="hs-varid">toList</span>
<a name="line-644"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-645"></a><span class="hs-comment">{-# INLINABLE map #-}</span>
<a name="line-646"></a><span class="hs-cpp">#endif</span>
<a name="line-647"></a>
<a name="line-648"></a><span class="hs-comment">-- | /O(n)/. The</span>
<a name="line-649"></a><span class="hs-comment">--</span>
<a name="line-650"></a><span class="hs-comment">-- @'mapMonotonic' f s == 'map' f s@, but works only when @f@ is monotonic.</span>
<a name="line-651"></a><span class="hs-comment">-- /The precondition is not checked./</span>
<a name="line-652"></a><span class="hs-comment">-- Semi-formally, we have:</span>
<a name="line-653"></a><span class="hs-comment">--</span>
<a name="line-654"></a><span class="hs-comment">-- &gt; and [x &lt; y ==&gt; f x &lt; f y | x &lt;- ls, y &lt;- ls]</span>
<a name="line-655"></a><span class="hs-comment">-- &gt;                     ==&gt; mapMonotonic f s == map f s</span>
<a name="line-656"></a><span class="hs-comment">-- &gt;     where ls = toList s</span>
<a name="line-657"></a>
<a name="line-658"></a><a name="mapMonotonic"></a><span class="hs-definition">mapMonotonic</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-keyglyph">-&gt;</span><span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">b</span>
<a name="line-659"></a><span class="hs-definition">mapMonotonic</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-660"></a><span class="hs-definition">mapMonotonic</span> <span class="hs-varid">f</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sz</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Bin</span> <span class="hs-varid">sz</span> <span class="hs-layout">(</span><span class="hs-varid">f</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">mapMonotonic</span> <span class="hs-varid">f</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">mapMonotonic</span> <span class="hs-varid">f</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-661"></a>
<a name="line-662"></a><a name="fold"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-663"></a>  Fold
<a name="line-664"></a>--------------------------------------------------------------------}</span>
<a name="line-665"></a><span class="hs-comment">-- | /O(n)/. Fold the elements in the set using the given right-associative</span>
<a name="line-666"></a><span class="hs-comment">-- binary operator. This function is an equivalent of 'foldr' and is present</span>
<a name="line-667"></a><span class="hs-comment">-- for compatibility only.</span>
<a name="line-668"></a><span class="hs-comment">--</span>
<a name="line-669"></a><span class="hs-comment">-- /Please note that fold will be deprecated in the future and removed./</span>
<a name="line-670"></a><span class="hs-definition">fold</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span>
<a name="line-671"></a><span class="hs-definition">fold</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldr</span>
<a name="line-672"></a><span class="hs-comment">{-# INLINE fold #-}</span>
<a name="line-673"></a>
<a name="line-674"></a><a name="foldr"></a><span class="hs-comment">-- | /O(n)/. Fold the elements in the set using the given right-associative</span>
<a name="line-675"></a><span class="hs-comment">-- binary operator, such that @'foldr' f z == 'Prelude.foldr' f z . 'toAscList'@.</span>
<a name="line-676"></a><span class="hs-comment">--</span>
<a name="line-677"></a><span class="hs-comment">-- For example,</span>
<a name="line-678"></a><span class="hs-comment">--</span>
<a name="line-679"></a><span class="hs-comment">-- &gt; toAscList set = foldr (:) [] set</span>
<a name="line-680"></a><span class="hs-definition">foldr</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span>
<a name="line-681"></a><span class="hs-definition">foldr</span> <span class="hs-varid">f</span> <span class="hs-varid">z</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-varid">z</span>
<a name="line-682"></a>  <span class="hs-keyword">where</span>
<a name="line-683"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">=</span> <span class="hs-varid">z'</span>
<a name="line-684"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-layout">(</span><span class="hs-varid">f</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-varid">r</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-varid">l</span>
<a name="line-685"></a><span class="hs-comment">{-# INLINE foldr #-}</span>
<a name="line-686"></a>
<a name="line-687"></a><a name="foldr'"></a><span class="hs-comment">-- | /O(n)/. A strict version of 'foldr'. Each application of the operator is</span>
<a name="line-688"></a><span class="hs-comment">-- evaluated before using the result in the next application. This</span>
<a name="line-689"></a><span class="hs-comment">-- function is strict in the starting value.</span>
<a name="line-690"></a><span class="hs-definition">foldr'</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span>
<a name="line-691"></a><span class="hs-definition">foldr'</span> <span class="hs-varid">f</span> <span class="hs-varid">z</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-varid">z</span>
<a name="line-692"></a>  <span class="hs-keyword">where</span>
<a name="line-693"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">go</span><span class="hs-layout">)</span>
<a name="line-694"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">=</span> <span class="hs-varid">z'</span>
<a name="line-695"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-layout">(</span><span class="hs-varid">f</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-varid">r</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-varid">l</span>
<a name="line-696"></a><span class="hs-comment">{-# INLINE foldr' #-}</span>
<a name="line-697"></a>
<a name="line-698"></a><a name="foldl"></a><span class="hs-comment">-- | /O(n)/. Fold the elements in the set using the given left-associative</span>
<a name="line-699"></a><span class="hs-comment">-- binary operator, such that @'foldl' f z == 'Prelude.foldl' f z . 'toAscList'@.</span>
<a name="line-700"></a><span class="hs-comment">--</span>
<a name="line-701"></a><span class="hs-comment">-- For example,</span>
<a name="line-702"></a><span class="hs-comment">--</span>
<a name="line-703"></a><span class="hs-comment">-- &gt; toDescList set = foldl (flip (:)) [] set</span>
<a name="line-704"></a><span class="hs-definition">foldl</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span>
<a name="line-705"></a><span class="hs-definition">foldl</span> <span class="hs-varid">f</span> <span class="hs-varid">z</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-varid">z</span>
<a name="line-706"></a>  <span class="hs-keyword">where</span>
<a name="line-707"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">=</span> <span class="hs-varid">z'</span>
<a name="line-708"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-layout">(</span><span class="hs-varid">f</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-709"></a><span class="hs-comment">{-# INLINE foldl #-}</span>
<a name="line-710"></a>
<a name="line-711"></a><a name="foldl'"></a><span class="hs-comment">-- | /O(n)/. A strict version of 'foldl'. Each application of the operator is</span>
<a name="line-712"></a><span class="hs-comment">-- evaluated before using the result in the next application. This</span>
<a name="line-713"></a><span class="hs-comment">-- function is strict in the starting value.</span>
<a name="line-714"></a><span class="hs-definition">foldl'</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span>
<a name="line-715"></a><span class="hs-definition">foldl'</span> <span class="hs-varid">f</span> <span class="hs-varid">z</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-varid">z</span>
<a name="line-716"></a>  <span class="hs-keyword">where</span>
<a name="line-717"></a>    <span class="hs-conid">STRICT_1_OF_2</span><span class="hs-layout">(</span><span class="hs-varid">go</span><span class="hs-layout">)</span>
<a name="line-718"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">=</span> <span class="hs-varid">z'</span>
<a name="line-719"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span> <span class="hs-layout">(</span><span class="hs-varid">f</span> <span class="hs-layout">(</span><span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-720"></a><span class="hs-comment">{-# INLINE foldl' #-}</span>
<a name="line-721"></a>
<a name="line-722"></a><a name="elems"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-723"></a>  List variations
<a name="line-724"></a>--------------------------------------------------------------------}</span>
<a name="line-725"></a><span class="hs-comment">-- | /O(n)/. An alias of 'toAscList'. The elements of a set in ascending order.</span>
<a name="line-726"></a><span class="hs-comment">-- Subject to list fusion.</span>
<a name="line-727"></a><span class="hs-definition">elems</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span>
<a name="line-728"></a><span class="hs-definition">elems</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">toAscList</span>
<a name="line-729"></a>
<a name="line-730"></a><a name="toList"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-731"></a>  Lists
<a name="line-732"></a>--------------------------------------------------------------------}</span>
<a name="line-733"></a><span class="hs-comment">-- | /O(n)/. Convert the set to a list of elements. Subject to list fusion.</span>
<a name="line-734"></a><span class="hs-definition">toList</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span>
<a name="line-735"></a><span class="hs-definition">toList</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">toAscList</span>
<a name="line-736"></a>
<a name="line-737"></a><a name="toAscList"></a><span class="hs-comment">-- | /O(n)/. Convert the set to an ascending list of elements. Subject to list fusion.</span>
<a name="line-738"></a><span class="hs-definition">toAscList</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span>
<a name="line-739"></a><span class="hs-definition">toAscList</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldr</span> <span class="hs-layout">(</span><span class="hs-conop">:</span><span class="hs-layout">)</span> <span class="hs-conid">[]</span>
<a name="line-740"></a>
<a name="line-741"></a><a name="toDescList"></a><span class="hs-comment">-- | /O(n)/. Convert the set to a descending list of elements. Subject to list</span>
<a name="line-742"></a><span class="hs-comment">-- fusion.</span>
<a name="line-743"></a><span class="hs-definition">toDescList</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span>
<a name="line-744"></a><span class="hs-definition">toDescList</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldl</span> <span class="hs-layout">(</span><span class="hs-varid">flip</span> <span class="hs-layout">(</span><span class="hs-conop">:</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-conid">[]</span>
<a name="line-745"></a>
<a name="line-746"></a><span class="hs-comment">-- List fusion for the list generating functions.</span>
<a name="line-747"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__</span>
<a name="line-748"></a><a name="foldrFB"></a><span class="hs-comment">-- The foldrFB and foldlFB are foldr and foldl equivalents, used for list fusion.</span>
<a name="line-749"></a><span class="hs-comment">-- They are important to convert unfused to{Asc,Desc}List back, see mapFB in prelude.</span>
<a name="line-750"></a><span class="hs-definition">foldrFB</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span>
<a name="line-751"></a><span class="hs-definition">foldrFB</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldr</span>
<a name="line-752"></a><a name="foldlFB"></a><span class="hs-comment">{-# INLINE[0] foldrFB #-}</span>
<a name="line-753"></a><span class="hs-definition">foldlFB</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span>
<a name="line-754"></a><span class="hs-definition">foldlFB</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldl</span>
<a name="line-755"></a><span class="hs-comment">{-# INLINE[0] foldlFB #-}</span>
<a name="line-756"></a>
<a name="line-757"></a><span class="hs-comment">-- Inline elems and toList, so that we need to fuse only toAscList.</span>
<a name="line-758"></a><span class="hs-comment">{-# INLINE elems #-}</span>
<a name="line-759"></a><span class="hs-comment">{-# INLINE toList #-}</span>
<a name="line-760"></a>
<a name="line-761"></a><span class="hs-comment">-- The fusion is enabled up to phase 2 included. If it does not succeed,</span>
<a name="line-762"></a><span class="hs-comment">-- convert in phase 1 the expanded to{Asc,Desc}List calls back to</span>
<a name="line-763"></a><span class="hs-comment">-- to{Asc,Desc}List.  In phase 0, we inline fold{lr}FB (which were used in</span>
<a name="line-764"></a><span class="hs-comment">-- a list fusion, otherwise it would go away in phase 1), and let compiler do</span>
<a name="line-765"></a><span class="hs-comment">-- whatever it wants with to{Asc,Desc}List -- it was forbidden to inline it</span>
<a name="line-766"></a><span class="hs-comment">-- before phase 0, otherwise the fusion rules would not fire at all.</span>
<a name="line-767"></a><span class="hs-comment">{-# NOINLINE[0] toAscList #-}</span>
<a name="line-768"></a><span class="hs-comment">{-# NOINLINE[0] toDescList #-}</span>
<a name="line-769"></a><span class="hs-comment">{-# RULES &quot;Set.toAscList&quot; [~1] forall s . toAscList s = build (\c n -&gt; foldrFB c n s) #-}</span>
<a name="line-770"></a><span class="hs-comment">{-# RULES &quot;Set.toAscListBack&quot; [1] foldrFB (:) [] = toAscList #-}</span>
<a name="line-771"></a><span class="hs-comment">{-# RULES &quot;Set.toDescList&quot; [~1] forall s . toDescList s = build (\c n -&gt; foldlFB (\xs x -&gt; c x xs) n s) #-}</span>
<a name="line-772"></a><span class="hs-comment">{-# RULES &quot;Set.toDescListBack&quot; [1] foldlFB (\xs x -&gt; x : xs) [] = toDescList #-}</span>
<a name="line-773"></a><span class="hs-cpp">#endif</span>
<a name="line-774"></a>
<a name="line-775"></a><a name="fromList"></a><span class="hs-comment">-- | /O(n*log n)/. Create a set from a list of elements.</span>
<a name="line-776"></a><span class="hs-definition">fromList</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-777"></a><span class="hs-definition">fromList</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">foldlStrict</span> <span class="hs-varid">ins</span> <span class="hs-varid">empty</span>
<a name="line-778"></a>  <span class="hs-keyword">where</span>
<a name="line-779"></a>    <span class="hs-varid">ins</span> <span class="hs-varid">t</span> <span class="hs-varid">x</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">insert</span> <span class="hs-varid">x</span> <span class="hs-varid">t</span>
<a name="line-780"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-781"></a><span class="hs-comment">{-# INLINABLE fromList #-}</span>
<a name="line-782"></a><span class="hs-cpp">#endif</span>
<a name="line-783"></a>
<a name="line-784"></a><a name="fromAscList"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-785"></a>  Building trees from ascending/descending lists can be done in linear time.
<a name="line-786"></a>
<a name="line-787"></a>  Note that if [xs] is ascending that:
<a name="line-788"></a>    fromAscList xs == fromList xs
<a name="line-789"></a>--------------------------------------------------------------------}</span>
<a name="line-790"></a><span class="hs-comment">-- | /O(n)/. Build a set from an ascending list in linear time.</span>
<a name="line-791"></a><span class="hs-comment">-- /The precondition (input list is ascending) is not checked./</span>
<a name="line-792"></a><span class="hs-definition">fromAscList</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Eq</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-793"></a><span class="hs-definition">fromAscList</span> <span class="hs-varid">xs</span>
<a name="line-794"></a>  <span class="hs-keyglyph">=</span> <span class="hs-varid">fromDistinctAscList</span> <span class="hs-layout">(</span><span class="hs-varid">combineEq</span> <span class="hs-varid">xs</span><span class="hs-layout">)</span>
<a name="line-795"></a>  <span class="hs-keyword">where</span>
<a name="line-796"></a>  <span class="hs-comment">-- [combineEq xs] combines equal elements with [const] in an ordered list [xs]</span>
<a name="line-797"></a>  <span class="hs-varid">combineEq</span> <span class="hs-varid">xs'</span>
<a name="line-798"></a>    <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">xs'</span> <span class="hs-keyword">of</span>
<a name="line-799"></a>        <span class="hs-conid">[]</span>     <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">[]</span>
<a name="line-800"></a>        <span class="hs-keyglyph">[</span><span class="hs-varid">x</span><span class="hs-keyglyph">]</span>    <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">x</span><span class="hs-keyglyph">]</span>
<a name="line-801"></a>        <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-conop">:</span><span class="hs-varid">xx</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">combineEq'</span> <span class="hs-varid">x</span> <span class="hs-varid">xx</span>
<a name="line-802"></a>
<a name="line-803"></a>  <span class="hs-varid">combineEq'</span> <span class="hs-varid">z</span> <span class="hs-conid">[]</span> <span class="hs-keyglyph">=</span> <span class="hs-keyglyph">[</span><span class="hs-varid">z</span><span class="hs-keyglyph">]</span>
<a name="line-804"></a>  <span class="hs-varid">combineEq'</span> <span class="hs-varid">z</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-conop">:</span><span class="hs-varid">xs'</span><span class="hs-layout">)</span>
<a name="line-805"></a>    <span class="hs-keyglyph">|</span> <span class="hs-varid">z</span><span class="hs-varop">==</span><span class="hs-varid">x</span>      <span class="hs-keyglyph">=</span>   <span class="hs-varid">combineEq'</span> <span class="hs-varid">z</span> <span class="hs-varid">xs'</span>
<a name="line-806"></a>    <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">z</span><span class="hs-conop">:</span><span class="hs-varid">combineEq'</span> <span class="hs-varid">x</span> <span class="hs-varid">xs'</span>
<a name="line-807"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-808"></a><span class="hs-comment">{-# INLINABLE fromAscList #-}</span>
<a name="line-809"></a><span class="hs-cpp">#endif</span>
<a name="line-810"></a>
<a name="line-811"></a>
<a name="line-812"></a><a name="fromDistinctAscList"></a><span class="hs-comment">-- | /O(n)/. Build a set from an ascending list of distinct elements in linear time.</span>
<a name="line-813"></a><span class="hs-comment">-- /The precondition (input list is strictly ascending) is not checked./</span>
<a name="line-814"></a><span class="hs-definition">fromDistinctAscList</span> <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-varid">a</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-815"></a><span class="hs-definition">fromDistinctAscList</span> <span class="hs-varid">xs</span>
<a name="line-816"></a>  <span class="hs-keyglyph">=</span> <span class="hs-varid">create</span> <span class="hs-varid">const</span> <span class="hs-layout">(</span><span class="hs-varid">length</span> <span class="hs-varid">xs</span><span class="hs-layout">)</span> <span class="hs-varid">xs</span>
<a name="line-817"></a>  <span class="hs-keyword">where</span>
<a name="line-818"></a>    <span class="hs-comment">-- 1) use continutations so that we use heap space instead of stack space.</span>
<a name="line-819"></a>    <span class="hs-comment">-- 2) special case for n==5 to create bushier trees.</span>
<a name="line-820"></a>    <span class="hs-varid">create</span> <span class="hs-varid">c</span> <span class="hs-num">0</span> <span class="hs-varid">xs'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">c</span> <span class="hs-conid">Tip</span> <span class="hs-varid">xs'</span>
<a name="line-821"></a>    <span class="hs-varid">create</span> <span class="hs-varid">c</span> <span class="hs-num">5</span> <span class="hs-varid">xs'</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">xs'</span> <span class="hs-keyword">of</span>
<a name="line-822"></a>                       <span class="hs-layout">(</span><span class="hs-varid">x1</span><span class="hs-conop">:</span><span class="hs-varid">x2</span><span class="hs-conop">:</span><span class="hs-varid">x3</span><span class="hs-conop">:</span><span class="hs-varid">x4</span><span class="hs-conop">:</span><span class="hs-varid">x5</span><span class="hs-conop">:</span><span class="hs-varid">xx</span><span class="hs-layout">)</span>
<a name="line-823"></a>                            <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">c</span> <span class="hs-layout">(</span><span class="hs-varid">bin</span> <span class="hs-varid">x4</span> <span class="hs-layout">(</span><span class="hs-varid">bin</span> <span class="hs-varid">x2</span> <span class="hs-layout">(</span><span class="hs-varid">singleton</span> <span class="hs-varid">x1</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">singleton</span> <span class="hs-varid">x3</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">singleton</span> <span class="hs-varid">x5</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-varid">xx</span>
<a name="line-824"></a>                       <span class="hs-keyword">_</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;fromDistinctAscList create 5&quot;</span>
<a name="line-825"></a>    <span class="hs-varid">create</span> <span class="hs-varid">c</span> <span class="hs-varid">n</span> <span class="hs-varid">xs'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">seq</span> <span class="hs-varid">nr</span> <span class="hs-varop">$</span> <span class="hs-varid">create</span> <span class="hs-layout">(</span><span class="hs-varid">createR</span> <span class="hs-varid">nr</span> <span class="hs-varid">c</span><span class="hs-layout">)</span> <span class="hs-varid">nl</span> <span class="hs-varid">xs'</span>
<a name="line-826"></a>      <span class="hs-keyword">where</span> <span class="hs-varid">nl</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">n</span> <span class="hs-varop">`div`</span> <span class="hs-num">2</span>
<a name="line-827"></a>            <span class="hs-varid">nr</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">n</span> <span class="hs-comment">-</span> <span class="hs-varid">nl</span> <span class="hs-comment">-</span> <span class="hs-num">1</span>
<a name="line-828"></a>
<a name="line-829"></a>    <span class="hs-varid">createR</span> <span class="hs-varid">n</span> <span class="hs-varid">c</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-conop">:</span><span class="hs-varid">ys</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">create</span> <span class="hs-layout">(</span><span class="hs-varid">createB</span> <span class="hs-varid">l</span> <span class="hs-varid">x</span> <span class="hs-varid">c</span><span class="hs-layout">)</span> <span class="hs-varid">n</span> <span class="hs-varid">ys</span>
<a name="line-830"></a>    <span class="hs-varid">createR</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-conid">[]</span>     <span class="hs-keyglyph">=</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;fromDistinctAscList createR []&quot;</span>
<a name="line-831"></a>    <span class="hs-varid">createB</span> <span class="hs-varid">l</span> <span class="hs-varid">x</span> <span class="hs-varid">c</span> <span class="hs-varid">r</span> <span class="hs-varid">zs</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">c</span> <span class="hs-layout">(</span><span class="hs-varid">bin</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-varid">zs</span>
<a name="line-832"></a>
<a name="line-833"></a><a name="instance%20Eq%20(Set%20a)"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-834"></a>  Eq converts the set to a list. In a lazy setting, this
<a name="line-835"></a>  actually seems one of the faster methods to compare two trees
<a name="line-836"></a>  and it is certainly the simplest :-)
<a name="line-837"></a>--------------------------------------------------------------------}</span>
<a name="line-838"></a><a name="instance%20Eq%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Eq</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Eq</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-839"></a>  <span class="hs-varid">t1</span> <span class="hs-varop">==</span> <span class="hs-varid">t2</span>  <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">t1</span> <span class="hs-varop">==</span> <span class="hs-varid">size</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-layout">(</span><span class="hs-varid">toAscList</span> <span class="hs-varid">t1</span> <span class="hs-varop">==</span> <span class="hs-varid">toAscList</span> <span class="hs-varid">t2</span><span class="hs-layout">)</span>
<a name="line-840"></a>
<a name="line-841"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-842"></a>  Ord
<a name="line-843"></a>--------------------------------------------------------------------}</span>
<a name="line-844"></a>
<a name="line-845"></a><a name="instance%20Ord%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Ord</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-846"></a>    <span class="hs-varid">compare</span> <span class="hs-varid">s1</span> <span class="hs-varid">s2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">compare</span> <span class="hs-layout">(</span><span class="hs-varid">toAscList</span> <span class="hs-varid">s1</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">toAscList</span> <span class="hs-varid">s2</span><span class="hs-layout">)</span>
<a name="line-847"></a>
<a name="line-848"></a><a name="instance%20Show%20(Set%20a)"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-849"></a>  Show
<a name="line-850"></a>--------------------------------------------------------------------}</span>
<a name="line-851"></a><a name="instance%20Show%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Show</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Show</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-852"></a>  <span class="hs-varid">showsPrec</span> <span class="hs-varid">p</span> <span class="hs-varid">xs</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">showParen</span> <span class="hs-layout">(</span><span class="hs-varid">p</span> <span class="hs-varop">&gt;</span> <span class="hs-num">10</span><span class="hs-layout">)</span> <span class="hs-varop">$</span>
<a name="line-853"></a>    <span class="hs-varid">showString</span> <span class="hs-str">&quot;fromList &quot;</span> <span class="hs-varop">.</span> <span class="hs-varid">shows</span> <span class="hs-layout">(</span><span class="hs-varid">toList</span> <span class="hs-varid">xs</span><span class="hs-layout">)</span>
<a name="line-854"></a>
<a name="line-855"></a><a name="instance%20Read%20(Set%20a)"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-856"></a>  Read
<a name="line-857"></a>--------------------------------------------------------------------}</span>
<a name="line-858"></a><a name="instance%20Read%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">Read</span> <span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Read</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-859"></a><span class="hs-cpp">#ifdef __GLASGOW_HASKELL__</span>
<a name="line-860"></a>  <span class="hs-varid">readPrec</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">parens</span> <span class="hs-varop">$</span> <span class="hs-varid">prec</span> <span class="hs-num">10</span> <span class="hs-varop">$</span> <span class="hs-keyword">do</span>
<a name="line-861"></a>    <span class="hs-conid">Ident</span> <span class="hs-str">&quot;fromList&quot;</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">lexP</span>
<a name="line-862"></a>    <span class="hs-varid">xs</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">readPrec</span>
<a name="line-863"></a>    <span class="hs-varid">return</span> <span class="hs-layout">(</span><span class="hs-varid">fromList</span> <span class="hs-varid">xs</span><span class="hs-layout">)</span>
<a name="line-864"></a>
<a name="line-865"></a>  <span class="hs-varid">readListPrec</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">readListPrecDefault</span>
<a name="line-866"></a><span class="hs-cpp">#else</span>
<a name="line-867"></a>  <span class="hs-varid">readsPrec</span> <span class="hs-varid">p</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">readParen</span> <span class="hs-layout">(</span><span class="hs-varid">p</span> <span class="hs-varop">&gt;</span> <span class="hs-num">10</span><span class="hs-layout">)</span> <span class="hs-varop">$</span> <span class="hs-keyglyph">\</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">do</span>
<a name="line-868"></a>    <span class="hs-layout">(</span><span class="hs-str">&quot;fromList&quot;</span><span class="hs-layout">,</span><span class="hs-varid">s</span><span class="hs-layout">)</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">lex</span> <span class="hs-varid">r</span>
<a name="line-869"></a>    <span class="hs-layout">(</span><span class="hs-varid">xs</span><span class="hs-layout">,</span><span class="hs-varid">t</span><span class="hs-layout">)</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">reads</span> <span class="hs-varid">s</span>
<a name="line-870"></a>    <span class="hs-varid">return</span> <span class="hs-layout">(</span><span class="hs-varid">fromList</span> <span class="hs-varid">xs</span><span class="hs-layout">,</span><span class="hs-varid">t</span><span class="hs-layout">)</span>
<a name="line-871"></a><span class="hs-cpp">#endif</span>
<a name="line-872"></a>
<a name="line-873"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-874"></a>  Typeable/Data
<a name="line-875"></a>--------------------------------------------------------------------}</span>
<a name="line-876"></a>
<a name="line-877"></a><span class="hs-cpp">#include &quot;Typeable.h&quot;</span>
<a name="line-878"></a><span class="hs-conid">INSTANCE_TYPEABLE1</span><span class="hs-layout">(</span><span class="hs-conid">Set</span><span class="hs-layout">,</span><span class="hs-varid">setTc</span><span class="hs-layout">,</span><span class="hs-str">&quot;Set&quot;</span><span class="hs-layout">)</span>
<a name="line-879"></a>
<a name="line-880"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-881"></a>  NFData
<a name="line-882"></a>--------------------------------------------------------------------}</span>
<a name="line-883"></a>
<a name="line-884"></a><a name="instance%20NFData%20(Set%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">NFData</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">NFData</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-885"></a>    <span class="hs-varid">rnf</span> <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">=</span> <span class="hs-conid">()</span>
<a name="line-886"></a>    <span class="hs-varid">rnf</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">rnf</span> <span class="hs-varid">y</span> <span class="hs-varop">`seq`</span> <span class="hs-varid">rnf</span> <span class="hs-varid">l</span> <span class="hs-varop">`seq`</span> <span class="hs-varid">rnf</span> <span class="hs-varid">r</span>
<a name="line-887"></a>
<a name="line-888"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-889"></a>  Utility functions that return sub-ranges of the original
<a name="line-890"></a>  tree. Some functions take a `Maybe value` as an argument to
<a name="line-891"></a>  allow comparisons against infinite values. These are called `blow`
<a name="line-892"></a>  (Nothing is -\infty) and `bhigh` (here Nothing is +\infty).
<a name="line-893"></a>  We use MaybeS value, which is a Maybe strict in the Just case.
<a name="line-894"></a>
<a name="line-895"></a>  [trim blow bhigh t]   A tree that is either empty or where [x &gt; blow]
<a name="line-896"></a>                        and [x &lt; bhigh] for the value [x] of the root.
<a name="line-897"></a>  [filterGt blow t]     A tree where for all values [k]. [k &gt; blow]
<a name="line-898"></a>  [filterLt bhigh t]    A tree where for all values [k]. [k &lt; bhigh]
<a name="line-899"></a>
<a name="line-900"></a>  [split k t]           Returns two trees [l] and [r] where all values
<a name="line-901"></a>                        in [l] are &lt;[k] and all keys in [r] are &gt;[k].
<a name="line-902"></a>  [splitMember k t]     Just like [split] but also returns whether [k]
<a name="line-903"></a>                        was found in the tree.
<a name="line-904"></a>--------------------------------------------------------------------}</span>
<a name="line-905"></a>
<a name="line-906"></a><a name="MaybeS"></a><span class="hs-keyword">data</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">NothingS</span> <span class="hs-keyglyph">|</span> <span class="hs-conid">JustS</span> <span class="hs-varop">!</span><span class="hs-varid">a</span>
<a name="line-907"></a>
<a name="line-908"></a><a name="trim"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-909"></a>  [trim blo bhi t] trims away all subtrees that surely contain no
<a name="line-910"></a>  values between the range [blo] to [bhi]. The returned tree is either
<a name="line-911"></a>  empty or the key of the root is between @blo@ and @bhi@.
<a name="line-912"></a>--------------------------------------------------------------------}</span>
<a name="line-913"></a><span class="hs-definition">trim</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-914"></a><span class="hs-definition">trim</span> <span class="hs-conid">NothingS</span>   <span class="hs-conid">NothingS</span>   <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t</span>
<a name="line-915"></a><span class="hs-definition">trim</span> <span class="hs-layout">(</span><span class="hs-conid">JustS</span> <span class="hs-varid">lx</span><span class="hs-layout">)</span> <span class="hs-conid">NothingS</span>   <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">greater</span> <span class="hs-varid">lx</span> <span class="hs-varid">t</span> <span class="hs-keyword">where</span> <span class="hs-varid">greater</span> <span class="hs-varid">lo</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-keyword">_</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">lo</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">greater</span> <span class="hs-varid">lo</span> <span class="hs-varid">r</span>
<a name="line-916"></a>                                                  <span class="hs-varid">greater</span> <span class="hs-keyword">_</span>  <span class="hs-varid">t'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t'</span>
<a name="line-917"></a><span class="hs-definition">trim</span> <span class="hs-conid">NothingS</span>   <span class="hs-layout">(</span><span class="hs-conid">JustS</span> <span class="hs-varid">hx</span><span class="hs-layout">)</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">lesser</span> <span class="hs-varid">hx</span> <span class="hs-varid">t</span>  <span class="hs-keyword">where</span> <span class="hs-varid">lesser</span>  <span class="hs-varid">hi</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&gt;=</span> <span class="hs-varid">hi</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">lesser</span>  <span class="hs-varid">hi</span> <span class="hs-varid">l</span>
<a name="line-918"></a>                                                  <span class="hs-varid">lesser</span>  <span class="hs-keyword">_</span>  <span class="hs-varid">t'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t'</span>
<a name="line-919"></a><span class="hs-definition">trim</span> <span class="hs-layout">(</span><span class="hs-conid">JustS</span> <span class="hs-varid">lx</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">JustS</span> <span class="hs-varid">hx</span><span class="hs-layout">)</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">middle</span> <span class="hs-varid">lx</span> <span class="hs-varid">hx</span> <span class="hs-varid">t</span>  <span class="hs-keyword">where</span> <span class="hs-varid">middle</span> <span class="hs-varid">lo</span> <span class="hs-varid">hi</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-keyword">_</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">lo</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">middle</span> <span class="hs-varid">lo</span> <span class="hs-varid">hi</span> <span class="hs-varid">r</span>
<a name="line-920"></a>                                                     <span class="hs-varid">middle</span> <span class="hs-varid">lo</span> <span class="hs-varid">hi</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">x</span> <span class="hs-varop">&gt;=</span> <span class="hs-varid">hi</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">middle</span> <span class="hs-varid">lo</span> <span class="hs-varid">hi</span> <span class="hs-varid">l</span>
<a name="line-921"></a>                                                     <span class="hs-varid">middle</span> <span class="hs-keyword">_</span>  <span class="hs-keyword">_</span>  <span class="hs-varid">t'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t'</span>
<a name="line-922"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-923"></a><span class="hs-comment">{-# INLINABLE trim #-}</span>
<a name="line-924"></a><span class="hs-cpp">#endif</span>
<a name="line-925"></a>
<a name="line-926"></a><a name="filterGt"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-927"></a>  [filterGt b t] filter all values &gt;[b] from tree [t]
<a name="line-928"></a>  [filterLt b t] filter all values &lt;[b] from tree [t]
<a name="line-929"></a>--------------------------------------------------------------------}</span>
<a name="line-930"></a><span class="hs-definition">filterGt</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-931"></a><span class="hs-definition">filterGt</span> <span class="hs-conid">NothingS</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t</span>
<a name="line-932"></a><span class="hs-definition">filterGt</span> <span class="hs-layout">(</span><span class="hs-conid">JustS</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">filter'</span> <span class="hs-varid">b</span> <span class="hs-varid">t</span>
<a name="line-933"></a>  <span class="hs-keyword">where</span> <span class="hs-varid">filter'</span> <span class="hs-keyword">_</span>   <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-934"></a>        <span class="hs-varid">filter'</span> <span class="hs-varid">b'</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span>
<a name="line-935"></a>          <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">b'</span> <span class="hs-varid">x</span> <span class="hs-keyword">of</span> <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-varid">filter'</span> <span class="hs-varid">b'</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-936"></a>                               <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">r</span>
<a name="line-937"></a>                               <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">filter'</span> <span class="hs-varid">b'</span> <span class="hs-varid">r</span>
<a name="line-938"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-939"></a><span class="hs-comment">{-# INLINABLE filterGt #-}</span>
<a name="line-940"></a><span class="hs-cpp">#endif</span>
<a name="line-941"></a>
<a name="line-942"></a><a name="filterLt"></a><span class="hs-definition">filterLt</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">MaybeS</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-943"></a><span class="hs-definition">filterLt</span> <span class="hs-conid">NothingS</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">t</span>
<a name="line-944"></a><span class="hs-definition">filterLt</span> <span class="hs-layout">(</span><span class="hs-conid">JustS</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-varid">t</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">filter'</span> <span class="hs-varid">b</span> <span class="hs-varid">t</span>
<a name="line-945"></a>  <span class="hs-keyword">where</span> <span class="hs-varid">filter'</span> <span class="hs-keyword">_</span>   <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Tip</span>
<a name="line-946"></a>        <span class="hs-varid">filter'</span> <span class="hs-varid">b'</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span>
<a name="line-947"></a>          <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">b'</span> <span class="hs-keyword">of</span> <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">filter'</span> <span class="hs-varid">b'</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-948"></a>                               <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">l</span>
<a name="line-949"></a>                               <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">filter'</span> <span class="hs-varid">b'</span> <span class="hs-varid">l</span>
<a name="line-950"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-951"></a><span class="hs-comment">{-# INLINABLE filterLt #-}</span>
<a name="line-952"></a><span class="hs-cpp">#endif</span>
<a name="line-953"></a>
<a name="line-954"></a><a name="split"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-955"></a>  Split
<a name="line-956"></a>--------------------------------------------------------------------}</span>
<a name="line-957"></a><span class="hs-comment">-- | /O(log n)/. The expression (@'split' x set@) is a pair @(set1,set2)@</span>
<a name="line-958"></a><span class="hs-comment">-- where @set1@ comprises the elements of @set@ less than @x@ and @set2@</span>
<a name="line-959"></a><span class="hs-comment">-- comprises the elements of @set@ greater than @x@.</span>
<a name="line-960"></a><span class="hs-definition">split</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">,</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-961"></a><span class="hs-definition">split</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-conid">Tip</span><span class="hs-layout">,</span><span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-962"></a><span class="hs-definition">split</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-963"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span>
<a name="line-964"></a>      <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span><span class="hs-varid">gt</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">split</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-keyword">in</span> <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span><span class="hs-varid">join</span> <span class="hs-varid">y</span> <span class="hs-varid">gt</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-965"></a>      <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span><span class="hs-varid">gt</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">split</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span> <span class="hs-keyword">in</span> <span class="hs-layout">(</span><span class="hs-varid">join</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">lt</span><span class="hs-layout">,</span><span class="hs-varid">gt</span><span class="hs-layout">)</span>
<a name="line-966"></a>      <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">l</span><span class="hs-layout">,</span><span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-967"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-968"></a><span class="hs-comment">{-# INLINABLE split #-}</span>
<a name="line-969"></a><span class="hs-cpp">#endif</span>
<a name="line-970"></a>
<a name="line-971"></a><a name="splitMember"></a><span class="hs-comment">-- | /O(log n)/. Performs a 'split' but also returns whether the pivot</span>
<a name="line-972"></a><span class="hs-comment">-- element was found in the original set.</span>
<a name="line-973"></a><span class="hs-definition">splitMember</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">,</span><span class="hs-conid">Bool</span><span class="hs-layout">,</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-974"></a><span class="hs-definition">splitMember</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-conid">Tip</span><span class="hs-layout">,</span> <span class="hs-conid">False</span><span class="hs-layout">,</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-975"></a><span class="hs-definition">splitMember</span> <span class="hs-varid">x</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-976"></a>   <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">compare</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyword">of</span>
<a name="line-977"></a>       <span class="hs-conid">LT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span> <span class="hs-varid">found</span><span class="hs-layout">,</span> <span class="hs-varid">gt</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">splitMember</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-keyword">in</span> <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span> <span class="hs-varid">found</span><span class="hs-layout">,</span> <span class="hs-varid">join</span> <span class="hs-varid">y</span> <span class="hs-varid">gt</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-978"></a>       <span class="hs-conid">GT</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">lt</span><span class="hs-layout">,</span> <span class="hs-varid">found</span><span class="hs-layout">,</span> <span class="hs-varid">gt</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">splitMember</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span> <span class="hs-keyword">in</span> <span class="hs-layout">(</span><span class="hs-varid">join</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">lt</span><span class="hs-layout">,</span> <span class="hs-varid">found</span><span class="hs-layout">,</span> <span class="hs-varid">gt</span><span class="hs-layout">)</span>
<a name="line-979"></a>       <span class="hs-conid">EQ</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">l</span><span class="hs-layout">,</span> <span class="hs-conid">True</span><span class="hs-layout">,</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-980"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 700</span>
<a name="line-981"></a><span class="hs-comment">{-# INLINABLE splitMember #-}</span>
<a name="line-982"></a><span class="hs-cpp">#endif</span>
<a name="line-983"></a>
<a name="line-984"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-985"></a>  Utility functions that maintain the balance properties of the tree.
<a name="line-986"></a>  All constructors assume that all values in [l] &lt; [x] and all values
<a name="line-987"></a>  in [r] &gt; [x], and that [l] and [r] are valid trees.
<a name="line-988"></a>
<a name="line-989"></a>  In order of sophistication:
<a name="line-990"></a>    [Bin sz x l r]    The type constructor.
<a name="line-991"></a>    [bin x l r]       Maintains the correct size, assumes that both [l]
<a name="line-992"></a>                      and [r] are balanced with respect to each other.
<a name="line-993"></a>    [balance x l r]   Restores the balance and size.
<a name="line-994"></a>                      Assumes that the original tree was balanced and
<a name="line-995"></a>                      that [l] or [r] has changed by at most one element.
<a name="line-996"></a>    [join x l r]      Restores balance and size.
<a name="line-997"></a>
<a name="line-998"></a>  Furthermore, we can construct a new tree from two trees. Both operations
<a name="line-999"></a>  assume that all values in [l] &lt; all values in [r] and that [l] and [r]
<a name="line-1000"></a>  are valid:
<a name="line-1001"></a>    [glue l r]        Glues [l] and [r] together. Assumes that [l] and
<a name="line-1002"></a>                      [r] are already balanced with respect to each other.
<a name="line-1003"></a>    [merge l r]       Merges two trees and restores balance.
<a name="line-1004"></a>
<a name="line-1005"></a>  Note: in contrast to Adam's paper, we use (&lt;=) comparisons instead
<a name="line-1006"></a>  of (&lt;) comparisons in [join], [merge] and [balance].
<a name="line-1007"></a>  Quickcheck (on [difference]) showed that this was necessary in order
<a name="line-1008"></a>  to maintain the invariants. It is quite unsatisfactory that I haven't
<a name="line-1009"></a>  been able to find out why this is actually the case! Fortunately, it
<a name="line-1010"></a>  doesn't hurt to be a bit more conservative.
<a name="line-1011"></a>--------------------------------------------------------------------}</span>
<a name="line-1012"></a>
<a name="line-1013"></a><a name="join"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1014"></a>  Join
<a name="line-1015"></a>--------------------------------------------------------------------}</span>
<a name="line-1016"></a><span class="hs-definition">join</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1017"></a><span class="hs-definition">join</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">insertMin</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span>
<a name="line-1018"></a><span class="hs-definition">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">insertMax</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span>
<a name="line-1019"></a><span class="hs-definition">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sizeL</span> <span class="hs-varid">y</span> <span class="hs-varid">ly</span> <span class="hs-varid">ry</span><span class="hs-layout">)</span> <span class="hs-varid">r</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sizeR</span> <span class="hs-varid">z</span> <span class="hs-varid">lz</span> <span class="hs-varid">rz</span><span class="hs-layout">)</span>
<a name="line-1020"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">sizeL</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">sizeR</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">z</span> <span class="hs-layout">(</span><span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">lz</span><span class="hs-layout">)</span> <span class="hs-varid">rz</span>
<a name="line-1021"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">sizeR</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">sizeL</span>  <span class="hs-keyglyph">=</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">y</span> <span class="hs-varid">ly</span> <span class="hs-layout">(</span><span class="hs-varid">join</span> <span class="hs-varid">x</span> <span class="hs-varid">ry</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1022"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span>            <span class="hs-keyglyph">=</span> <span class="hs-varid">bin</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1023"></a>
<a name="line-1024"></a>
<a name="line-1025"></a><a name="insertMax"></a><span class="hs-comment">-- insertMin and insertMax don't perform potentially expensive comparisons.</span>
<a name="line-1026"></a><span class="hs-definition">insertMax</span><span class="hs-layout">,</span><span class="hs-varid">insertMin</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1027"></a><span class="hs-definition">insertMax</span> <span class="hs-varid">x</span> <span class="hs-varid">t</span>
<a name="line-1028"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1029"></a>      <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">singleton</span> <span class="hs-varid">x</span>
<a name="line-1030"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1031"></a>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-layout">(</span><span class="hs-varid">insertMax</span> <span class="hs-varid">x</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1032"></a>
<a name="line-1033"></a><a name="insertMin"></a><span class="hs-definition">insertMin</span> <span class="hs-varid">x</span> <span class="hs-varid">t</span>
<a name="line-1034"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1035"></a>      <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">singleton</span> <span class="hs-varid">x</span>
<a name="line-1036"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">y</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1037"></a>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">y</span> <span class="hs-layout">(</span><span class="hs-varid">insertMin</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-1038"></a>
<a name="line-1039"></a><a name="merge"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1040"></a>  [merge l r]: merges two trees.
<a name="line-1041"></a>--------------------------------------------------------------------}</span>
<a name="line-1042"></a><span class="hs-definition">merge</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1043"></a><span class="hs-definition">merge</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">r</span>
<a name="line-1044"></a><span class="hs-definition">merge</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">l</span>
<a name="line-1045"></a><span class="hs-definition">merge</span> <span class="hs-varid">l</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sizeL</span> <span class="hs-varid">x</span> <span class="hs-varid">lx</span> <span class="hs-varid">rx</span><span class="hs-layout">)</span> <span class="hs-varid">r</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">sizeR</span> <span class="hs-varid">y</span> <span class="hs-varid">ly</span> <span class="hs-varid">ry</span><span class="hs-layout">)</span>
<a name="line-1046"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">sizeL</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">sizeR</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">y</span> <span class="hs-layout">(</span><span class="hs-varid">merge</span> <span class="hs-varid">l</span> <span class="hs-varid">ly</span><span class="hs-layout">)</span> <span class="hs-varid">ry</span>
<a name="line-1047"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">sizeR</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">sizeL</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">x</span> <span class="hs-varid">lx</span> <span class="hs-layout">(</span><span class="hs-varid">merge</span> <span class="hs-varid">rx</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1048"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span>           <span class="hs-keyglyph">=</span> <span class="hs-varid">glue</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1049"></a>
<a name="line-1050"></a><a name="glue"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1051"></a>  [glue l r]: glues two trees together.
<a name="line-1052"></a>  Assumes that [l] and [r] are already balanced with respect to each other.
<a name="line-1053"></a>--------------------------------------------------------------------}</span>
<a name="line-1054"></a><span class="hs-definition">glue</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1055"></a><span class="hs-definition">glue</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">r</span>
<a name="line-1056"></a><span class="hs-definition">glue</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">l</span>
<a name="line-1057"></a><span class="hs-definition">glue</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1058"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">size</span> <span class="hs-varid">l</span> <span class="hs-varop">&gt;</span> <span class="hs-varid">size</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">m</span><span class="hs-layout">,</span><span class="hs-varid">l'</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">deleteFindMax</span> <span class="hs-varid">l</span> <span class="hs-keyword">in</span> <span class="hs-varid">balanceR</span> <span class="hs-varid">m</span> <span class="hs-varid">l'</span> <span class="hs-varid">r</span>
<a name="line-1059"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span>       <span class="hs-keyglyph">=</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">m</span><span class="hs-layout">,</span><span class="hs-varid">r'</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">deleteFindMin</span> <span class="hs-varid">r</span> <span class="hs-keyword">in</span> <span class="hs-varid">balanceL</span> <span class="hs-varid">m</span> <span class="hs-varid">l</span> <span class="hs-varid">r'</span>
<a name="line-1060"></a>
<a name="line-1061"></a><span class="hs-comment">-- | /O(log n)/. Delete and find the minimal element.</span>
<a name="line-1062"></a><span class="hs-comment">--</span>
<a name="line-1063"></a><span class="hs-comment">-- &gt; deleteFindMin set = (findMin set, deleteMin set)</span>
<a name="line-1064"></a>
<a name="line-1065"></a><a name="deleteFindMin"></a><span class="hs-definition">deleteFindMin</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-layout">,</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-1066"></a><span class="hs-definition">deleteFindMin</span> <span class="hs-varid">t</span>
<a name="line-1067"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1068"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-layout">,</span><span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1069"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>   <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">xm</span><span class="hs-layout">,</span><span class="hs-varid">l'</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">deleteFindMin</span> <span class="hs-varid">l</span> <span class="hs-keyword">in</span> <span class="hs-layout">(</span><span class="hs-varid">xm</span><span class="hs-layout">,</span><span class="hs-varid">balanceR</span> <span class="hs-varid">x</span> <span class="hs-varid">l'</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1070"></a>      <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">error</span> <span class="hs-str">&quot;Set.deleteFindMin: can not return the minimal element of an empty set&quot;</span><span class="hs-layout">,</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1071"></a>
<a name="line-1072"></a><a name="deleteFindMax"></a><span class="hs-comment">-- | /O(log n)/. Delete and find the maximal element.</span>
<a name="line-1073"></a><span class="hs-comment">--</span>
<a name="line-1074"></a><span class="hs-comment">-- &gt; deleteFindMax set = (findMax set, deleteMax set)</span>
<a name="line-1075"></a><span class="hs-definition">deleteFindMax</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-layout">,</span><span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-1076"></a><span class="hs-definition">deleteFindMax</span> <span class="hs-varid">t</span>
<a name="line-1077"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1078"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-layout">,</span><span class="hs-varid">l</span><span class="hs-layout">)</span>
<a name="line-1079"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>   <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">let</span> <span class="hs-layout">(</span><span class="hs-varid">xm</span><span class="hs-layout">,</span><span class="hs-varid">r'</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">deleteFindMax</span> <span class="hs-varid">r</span> <span class="hs-keyword">in</span> <span class="hs-layout">(</span><span class="hs-varid">xm</span><span class="hs-layout">,</span><span class="hs-varid">balanceL</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r'</span><span class="hs-layout">)</span>
<a name="line-1080"></a>      <span class="hs-conid">Tip</span>           <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">error</span> <span class="hs-str">&quot;Set.deleteFindMax: can not return the maximal element of an empty set&quot;</span><span class="hs-layout">,</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1081"></a>
<a name="line-1082"></a><a name="minView"></a><span class="hs-comment">-- | /O(log n)/. Retrieves the minimal key of the set, and the set</span>
<a name="line-1083"></a><span class="hs-comment">-- stripped of that element, or 'Nothing' if passed an empty set.</span>
<a name="line-1084"></a><span class="hs-definition">minView</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-1085"></a><span class="hs-definition">minView</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Nothing</span>
<a name="line-1086"></a><span class="hs-definition">minView</span> <span class="hs-varid">x</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Just</span> <span class="hs-layout">(</span><span class="hs-varid">deleteFindMin</span> <span class="hs-varid">x</span><span class="hs-layout">)</span>
<a name="line-1087"></a>
<a name="line-1088"></a><a name="maxView"></a><span class="hs-comment">-- | /O(log n)/. Retrieves the maximal key of the set, and the set</span>
<a name="line-1089"></a><span class="hs-comment">-- stripped of that element, or 'Nothing' if passed an empty set.</span>
<a name="line-1090"></a><span class="hs-definition">maxView</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-1091"></a><span class="hs-definition">maxView</span> <span class="hs-conid">Tip</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Nothing</span>
<a name="line-1092"></a><span class="hs-definition">maxView</span> <span class="hs-varid">x</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Just</span> <span class="hs-layout">(</span><span class="hs-varid">deleteFindMax</span> <span class="hs-varid">x</span><span class="hs-layout">)</span>
<a name="line-1093"></a>
<a name="line-1094"></a><a name="delta"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1095"></a>  [balance x l r] balances two trees with value x.
<a name="line-1096"></a>  The sizes of the trees should balance after decreasing the
<a name="line-1097"></a>  size of one of them. (a rotation).
<a name="line-1098"></a>
<a name="line-1099"></a>  [delta] is the maximal relative difference between the sizes of
<a name="line-1100"></a>          two trees, it corresponds with the [w] in Adams' paper.
<a name="line-1101"></a>  [ratio] is the ratio between an outer and inner sibling of the
<a name="line-1102"></a>          heavier subtree in an unbalanced setting. It determines
<a name="line-1103"></a>          whether a double or single rotation should be performed
<a name="line-1104"></a>          to restore balance. It is correspondes with the inverse
<a name="line-1105"></a>          of $\alpha$ in Adam's article.
<a name="line-1106"></a>
<a name="line-1107"></a>  Note that according to the Adam's paper:
<a name="line-1108"></a>  - [delta] should be larger than 4.646 with a [ratio] of 2.
<a name="line-1109"></a>  - [delta] should be larger than 3.745 with a [ratio] of 1.534.
<a name="line-1110"></a>
<a name="line-1111"></a>  But the Adam's paper is errorneous:
<a name="line-1112"></a>  - it can be proved that for delta=2 and delta&gt;=5 there does
<a name="line-1113"></a>    not exist any ratio that would work
<a name="line-1114"></a>  - delta=4.5 and ratio=2 does not work
<a name="line-1115"></a>
<a name="line-1116"></a>  That leaves two reasonable variants, delta=3 and delta=4,
<a name="line-1117"></a>  both with ratio=2.
<a name="line-1118"></a>
<a name="line-1119"></a>  - A lower [delta] leads to a more 'perfectly' balanced tree.
<a name="line-1120"></a>  - A higher [delta] performs less rebalancing.
<a name="line-1121"></a>
<a name="line-1122"></a>  In the benchmarks, delta=3 is faster on insert operations,
<a name="line-1123"></a>  and delta=4 has slightly better deletes. As the insert speedup
<a name="line-1124"></a>  is larger, we currently use delta=3.
<a name="line-1125"></a>
<a name="line-1126"></a>--------------------------------------------------------------------}</span>
<a name="line-1127"></a><span class="hs-definition">delta</span><span class="hs-layout">,</span><span class="hs-varid">ratio</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Int</span>
<a name="line-1128"></a><span class="hs-definition">delta</span> <span class="hs-keyglyph">=</span> <span class="hs-num">3</span>
<a name="line-1129"></a><a name="ratio"></a><span class="hs-definition">ratio</span> <span class="hs-keyglyph">=</span> <span class="hs-num">2</span>
<a name="line-1130"></a>
<a name="line-1131"></a><span class="hs-comment">-- The balance function is equivalent to the following:</span>
<a name="line-1132"></a><span class="hs-comment">--</span>
<a name="line-1133"></a><span class="hs-comment">--   balance :: a -&gt; Set a -&gt; Set a -&gt; Set a</span>
<a name="line-1134"></a><span class="hs-comment">--   balance x l r</span>
<a name="line-1135"></a><span class="hs-comment">--     | sizeL + sizeR &lt;= 1   = Bin sizeX x l r</span>
<a name="line-1136"></a><span class="hs-comment">--     | sizeR &gt; delta*sizeL  = rotateL x l r</span>
<a name="line-1137"></a><span class="hs-comment">--     | sizeL &gt; delta*sizeR  = rotateR x l r</span>
<a name="line-1138"></a><span class="hs-comment">--     | otherwise            = Bin sizeX x l r</span>
<a name="line-1139"></a><span class="hs-comment">--     where</span>
<a name="line-1140"></a><span class="hs-comment">--       sizeL = size l</span>
<a name="line-1141"></a><span class="hs-comment">--       sizeR = size r</span>
<a name="line-1142"></a><span class="hs-comment">--       sizeX = sizeL + sizeR + 1</span>
<a name="line-1143"></a><span class="hs-comment">--</span>
<a name="line-1144"></a><span class="hs-comment">--   rotateL :: a -&gt; Set a -&gt; Set a -&gt; Set a</span>
<a name="line-1145"></a><span class="hs-comment">--   rotateL x l r@(Bin _ _ ly ry) | size ly &lt; ratio*size ry = singleL x l r</span>
<a name="line-1146"></a><span class="hs-comment">--                                 | otherwise               = doubleL x l r</span>
<a name="line-1147"></a><span class="hs-comment">--   rotateR :: a -&gt; Set a -&gt; Set a -&gt; Set a</span>
<a name="line-1148"></a><span class="hs-comment">--   rotateR x l@(Bin _ _ ly ry) r | size ry &lt; ratio*size ly = singleR x l r</span>
<a name="line-1149"></a><span class="hs-comment">--                                 | otherwise               = doubleR x l r</span>
<a name="line-1150"></a><span class="hs-comment">--</span>
<a name="line-1151"></a><span class="hs-comment">--   singleL, singleR :: a -&gt; Set a -&gt; Set a -&gt; Set a</span>
<a name="line-1152"></a><span class="hs-comment">--   singleL x1 t1 (Bin _ x2 t2 t3)  = bin x2 (bin x1 t1 t2) t3</span>
<a name="line-1153"></a><span class="hs-comment">--   singleR x1 (Bin _ x2 t1 t2) t3  = bin x2 t1 (bin x1 t2 t3)</span>
<a name="line-1154"></a><span class="hs-comment">--</span>
<a name="line-1155"></a><span class="hs-comment">--   doubleL, doubleR :: a -&gt; Set a -&gt; Set a -&gt; Set a</span>
<a name="line-1156"></a><span class="hs-comment">--   doubleL x1 t1 (Bin _ x2 (Bin _ x3 t2 t3) t4) = bin x3 (bin x1 t1 t2) (bin x2 t3 t4)</span>
<a name="line-1157"></a><span class="hs-comment">--   doubleR x1 (Bin _ x2 t1 (Bin _ x3 t2 t3)) t4 = bin x3 (bin x2 t1 t2) (bin x1 t3 t4)</span>
<a name="line-1158"></a><span class="hs-comment">--</span>
<a name="line-1159"></a><span class="hs-comment">-- It is only written in such a way that every node is pattern-matched only once.</span>
<a name="line-1160"></a><span class="hs-comment">--</span>
<a name="line-1161"></a><span class="hs-comment">-- Only balanceL and balanceR are needed at the moment, so balance is not here anymore.</span>
<a name="line-1162"></a><span class="hs-comment">-- In case it is needed, it can be found in Data.Map.</span>
<a name="line-1163"></a>
<a name="line-1164"></a><span class="hs-comment">-- Functions balanceL and balanceR are specialised versions of balance.</span>
<a name="line-1165"></a><span class="hs-comment">-- balanceL only checks whether the left subtree is too big,</span>
<a name="line-1166"></a><span class="hs-comment">-- balanceR only checks whether the right subtree is too big.</span>
<a name="line-1167"></a>
<a name="line-1168"></a><a name="balanceL"></a><span class="hs-comment">-- balanceL is called when left subtree might have been inserted to or when</span>
<a name="line-1169"></a><span class="hs-comment">-- right subtree might have been deleted from.</span>
<a name="line-1170"></a><span class="hs-definition">balanceL</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1171"></a><span class="hs-definition">balanceL</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">r</span> <span class="hs-keyword">of</span>
<a name="line-1172"></a>  <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-varid">l</span> <span class="hs-keyword">of</span>
<a name="line-1173"></a>           <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span>
<a name="line-1174"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">2</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span>
<a name="line-1175"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">lx</span> <span class="hs-conid">Tip</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">lrx</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">3</span> <span class="hs-varid">lrx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">lx</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1176"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">3</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1177"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">ls</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">lls</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-varid">lr</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">lrs</span> <span class="hs-varid">lrx</span> <span class="hs-varid">lrl</span> <span class="hs-varid">lrr</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-1178"></a>             <span class="hs-keyglyph">|</span> <span class="hs-varid">lrs</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">ratio</span><span class="hs-varop">*</span><span class="hs-varid">lls</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-layout">)</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">lrs</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">lr</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1179"></a>             <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-layout">)</span> <span class="hs-varid">lrx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">lls</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">lrl</span><span class="hs-layout">)</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span> <span class="hs-varid">lrl</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">lrr</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">lrr</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1180"></a>
<a name="line-1181"></a>  <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">rs</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-varid">l</span> <span class="hs-keyword">of</span>
<a name="line-1182"></a>           <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span>
<a name="line-1183"></a>
<a name="line-1184"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">ls</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span> <span class="hs-varid">lr</span><span class="hs-layout">)</span>
<a name="line-1185"></a>              <span class="hs-keyglyph">|</span> <span class="hs-varid">ls</span> <span class="hs-varop">&gt;</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">rs</span>  <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-layout">(</span><span class="hs-varid">ll</span><span class="hs-layout">,</span> <span class="hs-varid">lr</span><span class="hs-layout">)</span> <span class="hs-keyword">of</span>
<a name="line-1186"></a>                   <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">lls</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">,</span> <span class="hs-conid">Bin</span> <span class="hs-varid">lrs</span> <span class="hs-varid">lrx</span> <span class="hs-varid">lrl</span> <span class="hs-varid">lrr</span><span class="hs-layout">)</span>
<a name="line-1187"></a>                     <span class="hs-keyglyph">|</span> <span class="hs-varid">lrs</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">ratio</span><span class="hs-varop">*</span><span class="hs-varid">lls</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-varop">+</span><span class="hs-varid">lrs</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">lr</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1188"></a>                     <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">lrx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">lls</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">lrl</span><span class="hs-layout">)</span> <span class="hs-varid">lx</span> <span class="hs-varid">ll</span> <span class="hs-varid">lrl</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">lrr</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">lrr</span> <span class="hs-varid">r</span><span class="hs-layout">)</span>
<a name="line-1189"></a>                   <span class="hs-layout">(</span><span class="hs-keyword">_</span><span class="hs-layout">,</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;Failure in Data.Map.balanceL&quot;</span>
<a name="line-1190"></a>              <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1191"></a><span class="hs-comment">{-# NOINLINE balanceL #-}</span>
<a name="line-1192"></a>
<a name="line-1193"></a><a name="balanceR"></a><span class="hs-comment">-- balanceR is called when right subtree might have been inserted to or when</span>
<a name="line-1194"></a><span class="hs-comment">-- left subtree might have been deleted from.</span>
<a name="line-1195"></a><span class="hs-definition">balanceR</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1196"></a><span class="hs-definition">balanceR</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">l</span> <span class="hs-keyword">of</span>
<a name="line-1197"></a>  <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-varid">r</span> <span class="hs-keyword">of</span>
<a name="line-1198"></a>           <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span>
<a name="line-1199"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">2</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-varid">r</span>
<a name="line-1200"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">rx</span> <span class="hs-conid">Tip</span> <span class="hs-varid">rr</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">3</span> <span class="hs-varid">rx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-varid">rr</span>
<a name="line-1201"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">rx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">rlx</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-num">3</span> <span class="hs-varid">rlx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-num">1</span> <span class="hs-varid">rx</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span><span class="hs-layout">)</span>
<a name="line-1202"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">rs</span> <span class="hs-varid">rx</span> <span class="hs-varid">rl</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">rls</span> <span class="hs-varid">rlx</span> <span class="hs-varid">rll</span> <span class="hs-varid">rlr</span><span class="hs-layout">)</span> <span class="hs-varid">rr</span><span class="hs-keyglyph">@</span><span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">rrs</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-1203"></a>             <span class="hs-keyglyph">|</span> <span class="hs-varid">rls</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">ratio</span><span class="hs-varop">*</span><span class="hs-varid">rrs</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">rx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rls</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-varid">rl</span><span class="hs-layout">)</span> <span class="hs-varid">rr</span>
<a name="line-1204"></a>             <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">rlx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">rll</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-varid">rll</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rrs</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">rlr</span><span class="hs-layout">)</span> <span class="hs-varid">rx</span> <span class="hs-varid">rlr</span> <span class="hs-varid">rr</span><span class="hs-layout">)</span>
<a name="line-1205"></a>
<a name="line-1206"></a>  <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">ls</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-varid">r</span> <span class="hs-keyword">of</span>
<a name="line-1207"></a>           <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-conid">Tip</span>
<a name="line-1208"></a>
<a name="line-1209"></a>           <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">rs</span> <span class="hs-varid">rx</span> <span class="hs-varid">rl</span> <span class="hs-varid">rr</span><span class="hs-layout">)</span>
<a name="line-1210"></a>              <span class="hs-keyglyph">|</span> <span class="hs-varid">rs</span> <span class="hs-varop">&gt;</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">ls</span>  <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-layout">(</span><span class="hs-varid">rl</span><span class="hs-layout">,</span> <span class="hs-varid">rr</span><span class="hs-layout">)</span> <span class="hs-keyword">of</span>
<a name="line-1211"></a>                   <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-varid">rls</span> <span class="hs-varid">rlx</span> <span class="hs-varid">rll</span> <span class="hs-varid">rlr</span><span class="hs-layout">,</span> <span class="hs-conid">Bin</span> <span class="hs-varid">rrs</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span>
<a name="line-1212"></a>                     <span class="hs-keyglyph">|</span> <span class="hs-varid">rls</span> <span class="hs-varop">&lt;</span> <span class="hs-varid">ratio</span><span class="hs-varop">*</span><span class="hs-varid">rrs</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">rx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rls</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">rl</span><span class="hs-layout">)</span> <span class="hs-varid">rr</span>
<a name="line-1213"></a>                     <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">rlx</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">rll</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">rll</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">rrs</span><span class="hs-varop">+</span><span class="hs-varid">size</span> <span class="hs-varid">rlr</span><span class="hs-layout">)</span> <span class="hs-varid">rx</span> <span class="hs-varid">rlr</span> <span class="hs-varid">rr</span><span class="hs-layout">)</span>
<a name="line-1214"></a>                   <span class="hs-layout">(</span><span class="hs-keyword">_</span><span class="hs-layout">,</span> <span class="hs-keyword">_</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">error</span> <span class="hs-str">&quot;Failure in Data.Map.balanceR&quot;</span>
<a name="line-1215"></a>              <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-num">1</span><span class="hs-varop">+</span><span class="hs-varid">ls</span><span class="hs-varop">+</span><span class="hs-varid">rs</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1216"></a><span class="hs-comment">{-# NOINLINE balanceR #-}</span>
<a name="line-1217"></a>
<a name="line-1218"></a><a name="bin"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1219"></a>  The bin constructor maintains the size of the tree
<a name="line-1220"></a>--------------------------------------------------------------------}</span>
<a name="line-1221"></a><span class="hs-definition">bin</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span>
<a name="line-1222"></a><span class="hs-definition">bin</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1223"></a>  <span class="hs-keyglyph">=</span> <span class="hs-conid">Bin</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">l</span> <span class="hs-varop">+</span> <span class="hs-varid">size</span> <span class="hs-varid">r</span> <span class="hs-varop">+</span> <span class="hs-num">1</span><span class="hs-layout">)</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1224"></a><span class="hs-comment">{-# INLINE bin #-}</span>
<a name="line-1225"></a>
<a name="line-1226"></a>
<a name="line-1227"></a><a name="foldlStrict"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1228"></a>  Utilities
<a name="line-1229"></a>--------------------------------------------------------------------}</span>
<a name="line-1230"></a><span class="hs-definition">foldlStrict</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-varid">b</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">a</span>
<a name="line-1231"></a><span class="hs-definition">foldlStrict</span> <span class="hs-varid">f</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">go</span>
<a name="line-1232"></a>  <span class="hs-keyword">where</span>
<a name="line-1233"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z</span> <span class="hs-conid">[]</span>     <span class="hs-keyglyph">=</span> <span class="hs-varid">z</span>
<a name="line-1234"></a>    <span class="hs-varid">go</span> <span class="hs-varid">z</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-conop">:</span><span class="hs-varid">xs</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">let</span> <span class="hs-varid">z'</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">f</span> <span class="hs-varid">z</span> <span class="hs-varid">x</span> <span class="hs-keyword">in</span> <span class="hs-varid">z'</span> <span class="hs-varop">`seq`</span> <span class="hs-varid">go</span> <span class="hs-varid">z'</span> <span class="hs-varid">xs</span>
<a name="line-1235"></a><span class="hs-comment">{-# INLINE foldlStrict #-}</span>
<a name="line-1236"></a>
<a name="line-1237"></a><a name="showTree"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1238"></a>  Debugging
<a name="line-1239"></a>--------------------------------------------------------------------}</span>
<a name="line-1240"></a><span class="hs-comment">-- | /O(n)/. Show the tree that implements the set. The tree is shown</span>
<a name="line-1241"></a><span class="hs-comment">-- in a compressed, hanging format.</span>
<a name="line-1242"></a><span class="hs-definition">showTree</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Show</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">String</span>
<a name="line-1243"></a><span class="hs-definition">showTree</span> <span class="hs-varid">s</span>
<a name="line-1244"></a>  <span class="hs-keyglyph">=</span> <span class="hs-varid">showTreeWith</span> <span class="hs-conid">True</span> <span class="hs-conid">False</span> <span class="hs-varid">s</span>
<a name="line-1245"></a>
<a name="line-1246"></a>
<a name="line-1247"></a><a name="showTreeWith"></a><span class="hs-comment">{- | /O(n)/. The expression (@showTreeWith hang wide map@) shows
<a name="line-1248"></a> the tree that implements the set. If @hang@ is
<a name="line-1249"></a> @True@, a /hanging/ tree is shown otherwise a rotated tree is shown. If
<a name="line-1250"></a> @wide@ is 'True', an extra wide version is shown.
<a name="line-1251"></a>
<a name="line-1252"></a>&gt; Set&gt; putStrLn $ showTreeWith True False $ fromDistinctAscList [1..5]
<a name="line-1253"></a>&gt; 4
<a name="line-1254"></a>&gt; +--2
<a name="line-1255"></a>&gt; |  +--1
<a name="line-1256"></a>&gt; |  +--3
<a name="line-1257"></a>&gt; +--5
<a name="line-1258"></a>&gt;
<a name="line-1259"></a>&gt; Set&gt; putStrLn $ showTreeWith True True $ fromDistinctAscList [1..5]
<a name="line-1260"></a>&gt; 4
<a name="line-1261"></a>&gt; |
<a name="line-1262"></a>&gt; +--2
<a name="line-1263"></a>&gt; |  |
<a name="line-1264"></a>&gt; |  +--1
<a name="line-1265"></a>&gt; |  |
<a name="line-1266"></a>&gt; |  +--3
<a name="line-1267"></a>&gt; |
<a name="line-1268"></a>&gt; +--5
<a name="line-1269"></a>&gt;
<a name="line-1270"></a>&gt; Set&gt; putStrLn $ showTreeWith False True $ fromDistinctAscList [1..5]
<a name="line-1271"></a>&gt; +--5
<a name="line-1272"></a>&gt; |
<a name="line-1273"></a>&gt; 4
<a name="line-1274"></a>&gt; |
<a name="line-1275"></a>&gt; |  +--3
<a name="line-1276"></a>&gt; |  |
<a name="line-1277"></a>&gt; +--2
<a name="line-1278"></a>&gt;    |
<a name="line-1279"></a>&gt;    +--1
<a name="line-1280"></a>
<a name="line-1281"></a>-}</span>
<a name="line-1282"></a><span class="hs-definition">showTreeWith</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Show</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Bool</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">String</span>
<a name="line-1283"></a><span class="hs-definition">showTreeWith</span> <span class="hs-varid">hang</span> <span class="hs-varid">wide</span> <span class="hs-varid">t</span>
<a name="line-1284"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">hang</span>      <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">showsTreeHang</span> <span class="hs-varid">wide</span> <span class="hs-conid">[]</span> <span class="hs-varid">t</span><span class="hs-layout">)</span> <span class="hs-str">&quot;&quot;</span>
<a name="line-1285"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">showsTree</span> <span class="hs-varid">wide</span> <span class="hs-conid">[]</span> <span class="hs-conid">[]</span> <span class="hs-varid">t</span><span class="hs-layout">)</span> <span class="hs-str">&quot;&quot;</span>
<a name="line-1286"></a>
<a name="line-1287"></a><a name="showsTree"></a><span class="hs-definition">showsTree</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Show</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Bool</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">ShowS</span>
<a name="line-1288"></a><span class="hs-definition">showsTree</span> <span class="hs-varid">wide</span> <span class="hs-varid">lbars</span> <span class="hs-varid">rbars</span> <span class="hs-varid">t</span>
<a name="line-1289"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1290"></a>      <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showsBars</span> <span class="hs-varid">lbars</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;|\n&quot;</span>
<a name="line-1291"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span>
<a name="line-1292"></a>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showsBars</span> <span class="hs-varid">lbars</span> <span class="hs-varop">.</span> <span class="hs-varid">shows</span> <span class="hs-varid">x</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;\n&quot;</span>
<a name="line-1293"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1294"></a>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showsTree</span> <span class="hs-varid">wide</span> <span class="hs-layout">(</span><span class="hs-varid">withBar</span> <span class="hs-varid">rbars</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">withEmpty</span> <span class="hs-varid">rbars</span><span class="hs-layout">)</span> <span class="hs-varid">r</span> <span class="hs-varop">.</span>
<a name="line-1295"></a>             <span class="hs-varid">showWide</span> <span class="hs-varid">wide</span> <span class="hs-varid">rbars</span> <span class="hs-varop">.</span>
<a name="line-1296"></a>             <span class="hs-varid">showsBars</span> <span class="hs-varid">lbars</span> <span class="hs-varop">.</span> <span class="hs-varid">shows</span> <span class="hs-varid">x</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;\n&quot;</span> <span class="hs-varop">.</span>
<a name="line-1297"></a>             <span class="hs-varid">showWide</span> <span class="hs-varid">wide</span> <span class="hs-varid">lbars</span> <span class="hs-varop">.</span>
<a name="line-1298"></a>             <span class="hs-varid">showsTree</span> <span class="hs-varid">wide</span> <span class="hs-layout">(</span><span class="hs-varid">withEmpty</span> <span class="hs-varid">lbars</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">withBar</span> <span class="hs-varid">lbars</span><span class="hs-layout">)</span> <span class="hs-varid">l</span>
<a name="line-1299"></a>
<a name="line-1300"></a><a name="showsTreeHang"></a><span class="hs-definition">showsTreeHang</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Show</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Bool</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">ShowS</span>
<a name="line-1301"></a><span class="hs-definition">showsTreeHang</span> <span class="hs-varid">wide</span> <span class="hs-varid">bars</span> <span class="hs-varid">t</span>
<a name="line-1302"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1303"></a>      <span class="hs-conid">Tip</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showsBars</span> <span class="hs-varid">bars</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;|\n&quot;</span>
<a name="line-1304"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-conid">Tip</span> <span class="hs-conid">Tip</span>
<a name="line-1305"></a>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showsBars</span> <span class="hs-varid">bars</span> <span class="hs-varop">.</span> <span class="hs-varid">shows</span> <span class="hs-varid">x</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;\n&quot;</span>
<a name="line-1306"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span>
<a name="line-1307"></a>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showsBars</span> <span class="hs-varid">bars</span> <span class="hs-varop">.</span> <span class="hs-varid">shows</span> <span class="hs-varid">x</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;\n&quot;</span> <span class="hs-varop">.</span>
<a name="line-1308"></a>             <span class="hs-varid">showWide</span> <span class="hs-varid">wide</span> <span class="hs-varid">bars</span> <span class="hs-varop">.</span>
<a name="line-1309"></a>             <span class="hs-varid">showsTreeHang</span> <span class="hs-varid">wide</span> <span class="hs-layout">(</span><span class="hs-varid">withBar</span> <span class="hs-varid">bars</span><span class="hs-layout">)</span> <span class="hs-varid">l</span> <span class="hs-varop">.</span>
<a name="line-1310"></a>             <span class="hs-varid">showWide</span> <span class="hs-varid">wide</span> <span class="hs-varid">bars</span> <span class="hs-varop">.</span>
<a name="line-1311"></a>             <span class="hs-varid">showsTreeHang</span> <span class="hs-varid">wide</span> <span class="hs-layout">(</span><span class="hs-varid">withEmpty</span> <span class="hs-varid">bars</span><span class="hs-layout">)</span> <span class="hs-varid">r</span>
<a name="line-1312"></a>
<a name="line-1313"></a><a name="showWide"></a><span class="hs-definition">showWide</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Bool</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">String</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">String</span>
<a name="line-1314"></a><span class="hs-definition">showWide</span> <span class="hs-varid">wide</span> <span class="hs-varid">bars</span>
<a name="line-1315"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">wide</span>      <span class="hs-keyglyph">=</span> <span class="hs-varid">showString</span> <span class="hs-layout">(</span><span class="hs-varid">concat</span> <span class="hs-layout">(</span><span class="hs-varid">reverse</span> <span class="hs-varid">bars</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-str">&quot;|\n&quot;</span>
<a name="line-1316"></a>  <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">id</span>
<a name="line-1317"></a>
<a name="line-1318"></a><a name="showsBars"></a><span class="hs-definition">showsBars</span> <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">ShowS</span>
<a name="line-1319"></a><span class="hs-definition">showsBars</span> <span class="hs-varid">bars</span>
<a name="line-1320"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">bars</span> <span class="hs-keyword">of</span>
<a name="line-1321"></a>      <span class="hs-conid">[]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">id</span>
<a name="line-1322"></a>      <span class="hs-keyword">_</span>  <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">showString</span> <span class="hs-layout">(</span><span class="hs-varid">concat</span> <span class="hs-layout">(</span><span class="hs-varid">reverse</span> <span class="hs-layout">(</span><span class="hs-varid">tail</span> <span class="hs-varid">bars</span><span class="hs-layout">)</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-varop">.</span> <span class="hs-varid">showString</span> <span class="hs-varid">node</span>
<a name="line-1323"></a>
<a name="line-1324"></a><a name="node"></a><span class="hs-definition">node</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">String</span>
<a name="line-1325"></a><span class="hs-definition">node</span>           <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;+--&quot;</span>
<a name="line-1326"></a>
<a name="line-1327"></a><a name="withBar"></a><span class="hs-definition">withBar</span><span class="hs-layout">,</span> <span class="hs-varid">withEmpty</span> <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span>
<a name="line-1328"></a><span class="hs-definition">withBar</span> <span class="hs-varid">bars</span>   <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;|  &quot;</span><span class="hs-conop">:</span><span class="hs-varid">bars</span>
<a name="line-1329"></a><a name="withEmpty"></a><span class="hs-definition">withEmpty</span> <span class="hs-varid">bars</span> <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;   &quot;</span><span class="hs-conop">:</span><span class="hs-varid">bars</span>
<a name="line-1330"></a>
<a name="line-1331"></a><a name="valid"></a><span class="hs-comment">{--------------------------------------------------------------------
<a name="line-1332"></a>  Assertions
<a name="line-1333"></a>--------------------------------------------------------------------}</span>
<a name="line-1334"></a><span class="hs-comment">-- | /O(n)/. Test if the internal set structure is valid.</span>
<a name="line-1335"></a><span class="hs-definition">valid</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-1336"></a><span class="hs-definition">valid</span> <span class="hs-varid">t</span>
<a name="line-1337"></a>  <span class="hs-keyglyph">=</span> <span class="hs-varid">balanced</span> <span class="hs-varid">t</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">ordered</span> <span class="hs-varid">t</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">validsize</span> <span class="hs-varid">t</span>
<a name="line-1338"></a>
<a name="line-1339"></a><a name="ordered"></a><span class="hs-definition">ordered</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Ord</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-1340"></a><span class="hs-definition">ordered</span> <span class="hs-varid">t</span>
<a name="line-1341"></a>  <span class="hs-keyglyph">=</span> <span class="hs-varid">bounded</span> <span class="hs-layout">(</span><span class="hs-varid">const</span> <span class="hs-conid">True</span><span class="hs-layout">)</span> <span class="hs-layout">(</span><span class="hs-varid">const</span> <span class="hs-conid">True</span><span class="hs-layout">)</span> <span class="hs-varid">t</span>
<a name="line-1342"></a>  <span class="hs-keyword">where</span>
<a name="line-1343"></a>    <span class="hs-varid">bounded</span> <span class="hs-varid">lo</span> <span class="hs-varid">hi</span> <span class="hs-varid">t'</span>
<a name="line-1344"></a>      <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t'</span> <span class="hs-keyword">of</span>
<a name="line-1345"></a>          <span class="hs-conid">Tip</span>         <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">True</span>
<a name="line-1346"></a>          <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-varid">x</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">lo</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-layout">(</span><span class="hs-varid">hi</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">bounded</span> <span class="hs-varid">lo</span> <span class="hs-layout">(</span><span class="hs-varop">&lt;</span><span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-varid">l</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">bounded</span> <span class="hs-layout">(</span><span class="hs-varop">&gt;</span><span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-varid">hi</span> <span class="hs-varid">r</span>
<a name="line-1347"></a>
<a name="line-1348"></a><a name="balanced"></a><span class="hs-definition">balanced</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-1349"></a><span class="hs-definition">balanced</span> <span class="hs-varid">t</span>
<a name="line-1350"></a>  <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t</span> <span class="hs-keyword">of</span>
<a name="line-1351"></a>      <span class="hs-conid">Tip</span>         <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">True</span>
<a name="line-1352"></a>      <span class="hs-conid">Bin</span> <span class="hs-keyword">_</span> <span class="hs-keyword">_</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">l</span> <span class="hs-varop">+</span> <span class="hs-varid">size</span> <span class="hs-varid">r</span> <span class="hs-varop">&lt;=</span> <span class="hs-num">1</span> <span class="hs-varop">||</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">l</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">size</span> <span class="hs-varid">r</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">size</span> <span class="hs-varid">r</span> <span class="hs-varop">&lt;=</span> <span class="hs-varid">delta</span><span class="hs-varop">*</span><span class="hs-varid">size</span> <span class="hs-varid">l</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-varop">&amp;&amp;</span>
<a name="line-1353"></a>                     <span class="hs-varid">balanced</span> <span class="hs-varid">l</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-varid">balanced</span> <span class="hs-varid">r</span>
<a name="line-1354"></a>
<a name="line-1355"></a><a name="validsize"></a><span class="hs-definition">validsize</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Set</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span>
<a name="line-1356"></a><span class="hs-definition">validsize</span> <span class="hs-varid">t</span>
<a name="line-1357"></a>  <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">realsize</span> <span class="hs-varid">t</span> <span class="hs-varop">==</span> <span class="hs-conid">Just</span> <span class="hs-layout">(</span><span class="hs-varid">size</span> <span class="hs-varid">t</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-1358"></a>  <span class="hs-keyword">where</span>
<a name="line-1359"></a>    <span class="hs-varid">realsize</span> <span class="hs-varid">t'</span>
<a name="line-1360"></a>      <span class="hs-keyglyph">=</span> <span class="hs-keyword">case</span> <span class="hs-varid">t'</span> <span class="hs-keyword">of</span>
<a name="line-1361"></a>          <span class="hs-conid">Tip</span>          <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Just</span> <span class="hs-num">0</span>
<a name="line-1362"></a>          <span class="hs-conid">Bin</span> <span class="hs-varid">sz</span> <span class="hs-keyword">_</span> <span class="hs-varid">l</span> <span class="hs-varid">r</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">case</span> <span class="hs-layout">(</span><span class="hs-varid">realsize</span> <span class="hs-varid">l</span><span class="hs-layout">,</span><span class="hs-varid">realsize</span> <span class="hs-varid">r</span><span class="hs-layout">)</span> <span class="hs-keyword">of</span>
<a name="line-1363"></a>                            <span class="hs-layout">(</span><span class="hs-conid">Just</span> <span class="hs-varid">n</span><span class="hs-layout">,</span><span class="hs-conid">Just</span> <span class="hs-varid">m</span><span class="hs-layout">)</span>  <span class="hs-keyglyph">|</span> <span class="hs-varid">n</span><span class="hs-varop">+</span><span class="hs-varid">m</span><span class="hs-varop">+</span><span class="hs-num">1</span> <span class="hs-varop">==</span> <span class="hs-varid">sz</span>  <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Just</span> <span class="hs-varid">sz</span>
<a name="line-1364"></a>                            <span class="hs-keyword">_</span>                <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Nothing</span>
</pre></body>
</html>
