<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta><title>Blaze.ByteString.Builder.Internal.Buffer</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean"></link><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Blaze-ByteString-Builder-Internal-Buffer.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="../blaze-builder-0.3.3.2/index.html">Contents</a></li><li><a href="../blaze-builder-0.3.3.2/doc-index.html">Index</a></li></ul><p class="caption">blaze-builder-0.3.3.2: Efficient buffered output.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Portability</th><td>tested on GHC only</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Maintainer</th><td>Simon Meier &lt;iridcode@gmail.com&gt;</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Blaze.ByteString.Builder.Internal.Buffer</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="../blaze-builder-0.3.3.2/#g:1">Buffers
</a><ul><li><a href="../blaze-builder-0.3.3.2/#g:2">Status information
</a></li><li><a href="../blaze-builder-0.3.3.2/#g:3">Creation and modification
</a></li><li><a href="../blaze-builder-0.3.3.2/#g:4">Conversion to bytestings
</a></li></ul></li><li><a href="../blaze-builder-0.3.3.2/#g:5">Buffer allocation strategies
</a></li><li><a href="../blaze-builder-0.3.3.2/#g:6">Executing puts respect to some monad
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Execution of the <code><a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:Put">Put</a></code> monad and hence also <code><a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:Builder">Builder</a></code>s with respect to
 buffers.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="../blaze-builder-0.3.3.2/#t:Buffer">Buffer</a>  = <a href="../blaze-builder-0.3.3.2/#v:Buffer">Buffer</a> !(<a href="../base-4.6.0.1/Foreign-ForeignPtr-Safe.html#t:ForeignPtr">ForeignPtr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>) !(<a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>) !(<a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>) !(<a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>)</li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:freeSize">freeSize</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:sliceSize">sliceSize</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:bufferSize">bufferSize</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:allocBuffer">allocBuffer</a> :: <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:reuseBuffer">reuseBuffer</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:nextSlice">nextSlice</a> :: <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:updateEndOfSlice">updateEndOfSlice</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:execBuildStep">execBuildStep</a> ::  <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildStep">BuildStep</a> a -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> (<a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildSignal">BuildSignal</a> a)</li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:unsafeFreezeBuffer">unsafeFreezeBuffer</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../bytestring-0.10.0.2/Data-ByteString.html#t:ByteString">ByteString</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:unsafeFreezeNonEmptyBuffer">unsafeFreezeNonEmptyBuffer</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../bytestring-0.10.0.2/Data-ByteString.html#t:ByteString">ByteString</a></li><li class="src short"><span class="keyword">type</span> <a href="../blaze-builder-0.3.3.2/#t:BufferAllocStrategy">BufferAllocStrategy</a> = (<a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>, <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> (<a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>))</li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:allNewBuffersStrategy">allNewBuffersStrategy</a> :: <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:BufferAllocStrategy">BufferAllocStrategy</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:reuseBufferStrategy">reuseBufferStrategy</a> :: <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:BufferAllocStrategy">BufferAllocStrategy</a></li><li class="src short"><a href="../blaze-builder-0.3.3.2/#v:runPut">runPut</a> :: <a href="../base-4.6.0.1/Control-Monad.html#t:Monad">Monad</a> m =&gt; (<a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> (<a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildSignal">BuildSignal</a> a) -&gt; m (<a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildSignal">BuildSignal</a> a)) -&gt; (<a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; m <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>) -&gt; (<a href="../bytestring-0.10.0.2/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m ()) -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:Put">Put</a> a -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; m (a, <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>)</li></ul></div><div id="interface"><h1 id="g:1">Buffers
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Buffer" class="def">Buffer</a>  </p><div class="doc"><p>A buffer <code>Buffer fpbuf p0 op ope</code> describes a buffer with the underlying
 byte array <code>fpbuf..ope</code>, the currently written slice <code>p0..op</code> and the free
 space <code>op..ope</code>.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Buffer" class="def">Buffer</a> !(<a href="../base-4.6.0.1/Foreign-ForeignPtr-Safe.html#t:ForeignPtr">ForeignPtr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>) !(<a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>) !(<a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>) !(<a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a>)</td><td class="doc empty">Â </td></tr></table></div></div><h2 id="g:2">Status information
</h2><div class="top"><p class="src"><a name="v:freeSize" class="def">freeSize</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a></p><div class="doc"><p>The size of the free space of the buffer.
</p></div></div><div class="top"><p class="src"><a name="v:sliceSize" class="def">sliceSize</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a></p><div class="doc"><p>The size of the written slice in the buffer.
</p></div></div><div class="top"><p class="src"><a name="v:bufferSize" class="def">bufferSize</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a></p><div class="doc"><p>The size of the whole byte array underlying the buffer.
</p></div></div><h2 id="g:3">Creation and modification
</h2><div class="top"><p class="src"><a name="v:allocBuffer" class="def">allocBuffer</a> :: <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></p><div class="doc"><p><code>allocBuffer size</code> allocates a new buffer of size <code>size</code>.
</p></div></div><div class="top"><p class="src"><a name="v:reuseBuffer" class="def">reuseBuffer</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></p><div class="doc"><p>Resets the beginning of the next slice and the next free byte such that
 the whole buffer can be filled again.
</p></div></div><div class="top"><p class="src"><a name="v:nextSlice" class="def">nextSlice</a> :: <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></p><div class="doc"><p>Move the beginning of the slice to the next free byte such that the
 remaining free space of the buffer can be filled further. This operation
 is safe and can be used to fill the remaining part of the buffer after a
 direct insertion of a bytestring or a flush.
</p></div></div><div class="top"><p class="src"><a name="v:updateEndOfSlice" class="def">updateEndOfSlice</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="../base-4.6.0.1/Data-Word.html#t:Word8">Word8</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a></p><div class="doc"><p>Update the end of slice pointer.
</p></div></div><div class="top"><p class="src"><a name="v:execBuildStep" class="def">execBuildStep</a> ::  <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildStep">BuildStep</a> a -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> (<a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildSignal">BuildSignal</a> a)</p><div class="doc"><p>Execute a build step on the given buffer.
</p></div></div><h2 id="g:4">Conversion to bytestings
</h2><div class="top"><p class="src"><a name="v:unsafeFreezeBuffer" class="def">unsafeFreezeBuffer</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../bytestring-0.10.0.2/Data-ByteString.html#t:ByteString">ByteString</a></p><div class="doc"><p>Convert the buffer to a bytestring. This operation is unsafe in the sense
 that created bytestring shares the underlying byte array with the buffer.
 Hence, depending on the later use of this buffer (e.g., if it gets reset and
 filled again) referential transparency may be lost.
</p></div></div><div class="top"><p class="src"><a name="v:unsafeFreezeNonEmptyBuffer" class="def">unsafeFreezeNonEmptyBuffer</a> :: <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../bytestring-0.10.0.2/Data-ByteString.html#t:ByteString">ByteString</a></p><div class="doc"><p>Convert a buffer to a non-empty bytestring. See <code><a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#v:unsafeFreezeBuffer">unsafeFreezeBuffer</a></code> for
 the explanation of why this operation may be unsafe.
</p></div></div><h1 id="g:5">Buffer allocation strategies
</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:BufferAllocStrategy" class="def">BufferAllocStrategy</a> = (<a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>, <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> (<a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>))</p><div class="doc"><p>A buffer allocation strategy <code>(buf0, nextBuf)</code> specifies the initial
 buffer to use and how to compute a new buffer <code>nextBuf minSize buf</code> with at
 least size <code>minSize</code> from a filled buffer <code>buf</code>. The double nesting of the
 <code>IO</code> monad helps to ensure that the reference to the filled buffer <code>buf</code> is
 lost as soon as possible, but the new buffer doesn't have to be allocated
 too early.
</p></div></div><div class="top"><p class="src"><a name="v:allNewBuffersStrategy" class="def">allNewBuffersStrategy</a> :: <a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:BufferAllocStrategy">BufferAllocStrategy</a></p><div class="doc"><p>The simplest buffer allocation strategy: whenever a buffer is requested,
 allocate a new one that is big enough for the next build step to execute.
</p><p>NOTE that this allocation strategy may spill quite some memory upon direct
 insertion of a bytestring by the builder. Thats no problem for garbage
 collection, but it may lead to unreasonably high memory consumption in
 special circumstances.
</p></div></div><div class="top"><p class="src"><a name="v:reuseBufferStrategy" class="def">reuseBufferStrategy</a> :: <a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:BufferAllocStrategy">BufferAllocStrategy</a></p><div class="doc"><p>An unsafe, but possibly more efficient buffer allocation strategy:
 reuse the buffer, if it is big enough for the next build step to execute.
</p></div></div><h1 id="g:6">Executing puts respect to some monad
</h1><div class="top"><p class="src"><a name="v:runPut" class="def">runPut</a> :: <a href="../base-4.6.0.1/Control-Monad.html#t:Monad">Monad</a> m =&gt; (<a href="../base-4.6.0.1/System-IO.html#t:IO">IO</a> (<a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildSignal">BuildSignal</a> a) -&gt; m (<a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:BuildSignal">BuildSignal</a> a)) -&gt; (<a href="../base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; m <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>) -&gt; (<a href="../bytestring-0.10.0.2/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m ()) -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Types.html#t:Put">Put</a> a -&gt; <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a> -&gt; m (a, <a href="../blaze-builder-0.3.3.2/Blaze-ByteString-Builder-Internal-Buffer.html#t:Buffer">Buffer</a>)</p><div class="doc"><p>Execute a put on a buffer.
</p><p>TODO: Generalize over buffer allocation strategy.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2.1</p></div></body></html>